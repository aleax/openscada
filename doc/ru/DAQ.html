<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="UTF-8" />
<title>Документы/Сбор данных - OpenSCADAWiki</title>
<meta content="MediaWiki 1.26.4" name="generator" />
<link href="https://www.gnu.org/copyleft/fdl.html" rel="copyright" />
<link href="../en/files/doc.css" rel="stylesheet" /></head>
<body><div class="floatright"><a href="http://oscada.org"><img alt="OpenSCADA" src="../en/files/Logo-big.png" /></a></div><div id="mw_header">
			<div class="mw-indicators">
</div>
			<h1 id="firstHeading" lang="ru">Документы/Сбор данных</h1>
		</div><div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="ru"><div class="mw-pt-translate-header noprint" dir="ltr" lang="en">This page is a <span class="plainlinks"><a class="external text" href="http://oscada.org/wiki/index.php?title=Special:Translate&amp;group=page-Documents%2FDAQ&amp;action=page&amp;filter=&amp;language=ru" rel="nofollow noreferrer noopener" target="_blank">translated version</a></span> of the page <a class="external" href="http://oscada.org/wiki/Documents/DAQ" title="Documents/DAQ">Documents/DAQ</a> and the translation is 100% complete.</div><hr /><div class="mw-pt-languages" dir="ltr" lang="en"><div class="mw-pt-languages-list autonym"><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" href="../en/DAQ.html" title="Documents/DAQ (100% translated)">English</a>&nbsp;• ‎<span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete">российский</span>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="../uk/DAQ.html" title="Документи/Збір даних (100% translated)">українська</a></div></div>
<p><i>Автор:</i> <a class="external" href="http://oscada.org/wiki/User:RomanSavochenko" title="User:RomanSavochenko">Роман Савоченко</a>
</p><p><br />
</p>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B_.D1.81.D0.B1.D0.BE.D1.80.D0.B0_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="tocnumber">1</span> <span class="toctext">Методы сбора данных</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#.D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9_.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="tocnumber">1.1</span> <span class="toctext">Простой синхронный механизм сбора</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#.D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9_.D0.B0.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="tocnumber">1.2</span> <span class="toctext">Простой асинхронный механизм сбора</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#.D0.9F.D0.B0.D0.BA.D0.B5.D1.82.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="tocnumber">1.3</span> <span class="toctext">Пакетный механизм сбора</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.D0.9F.D0.B0.D1.81.D1.81.D0.B8.D0.B2.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0_.D0.B8_.D0.B8.D0.BD.D0.B8.D1.86.D0.B8.D0.B0.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F"><span class="tocnumber">1.4</span> <span class="toctext"><span>Пассивный механизм сбора и инициативные подключения</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#.D0.92.D0.B8.D1.80.D1.82.D1.83.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.B8_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="tocnumber">2</span> <span class="toctext"><span>Виртуальные источники данных</span></span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#.D0.9B.D0.BE.D0.B3.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D1.83.D1.80.D0.BE.D0.B2.D0.B5.D0.BD.D1.8C_.D0.BE.D0.B1.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B8_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="tocnumber">3</span> <span class="toctext"><span>Логический уровень обработки данных</span></span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#.D0.9A.D0.BE.D0.BD.D1.86.D0.B5.D0.BF.D1.86.D0.B8.D1.8F_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BA_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D0.BC_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B8.D0.B9_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB"><span class="tocnumber">3.1</span> <span class="toctext"><span>Концепция доступа к данным через пользовательский протокол</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#.D0.A0.D0.B5.D0.B7.D0.B5.D1.80.D0.B2.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.BE.D0.B2_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="tocnumber">4</span> <span class="toctext"><span>Резервирование источников данных</span></span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#.D0.9C.D0.B5.D1.82.D0.BA.D0.B0_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.B0_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="tocnumber">5</span> <span class="toctext"><span>Метка времени источника данных</span></span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#.D0.A1.D1.81.D1.8B.D0.BB.D0.BA.D0.B8"><span class="tocnumber">6</span> <span class="toctext">Ссылки</span></a></li>
</ul>
</div>

<p>Сбор данных SCADA(Supervisory Control and Data Acquisition)-системы является её неотъемлемой частью, которая занимается получением данных из источников различного происхождения. Природа данных, с которыми работает SCADA, характеризуется сигналами базовых типов значений (целое, вещественное, логическое и строка). Сигналы изменяются во времени и обладает историей — жизнью. В теории управления технологическими процессами (ТП), под сигналом понимается значение датчика установки ТП в коде АЦП — "сырой" сигнал или в реальном значении — инженерный. Сигналы могут объединяться в группы по смысловой нагрузке, часто называемые параметрами или комплексным тегом. Например, развитые источники данных могут предоставлять структуры параметров с предопределённым набором связанных сигналов. Кроме непосредственного сбора данных, в функции этого механизма также входит и передача воздействий на исполнительные устройства управления ТП, обычно это: задвижки, насосы и регулирующие клапаны. Совокупно, это оборудование получило название — Устройство Сопряжения с Объектом (УСО).
</p><p>Источники данных характеризуются большим разнообразием, которое можно условно разделить на три группы:
</p>
<ul><li> Источники "сырых" данных, предоставляющие код АЦП или уровни дискретных сигналов, а также включающие простейшую обработку. Обычно это модули рассредоточенного УСО или простейшие промышленные программируемые логические контроллеры (ПЛК).</li>
<li> Мощные промышленные ПЛК, обладающие значительной вычислительной мощностью и возможностью формирования сложных параметров с различной структурой.</li>
<li> Локальные или сопутствующие источники данных. Например, УСО в виде плат расширения, а также данные аппаратного и программного окружения в котором функционирует система.</li></ul>
<p>Разнообразие источников данных породило большой спектр механизмов доступа к ним. Локальные источники данных различаются интерфейсами программирования приложения (API), а сетевые источники, в свою очередь, транспортным и протокольным уровнями взаимодействия. В целом, это привело к тому, что добавление поддержки нового источника данных требует создание модуля сопряжения или драйвера. Учитывая же большое разнообразие источников, это крайне накладно и фактически нереально охватить весь спектр рынка таких устройств. Ситуация несколько упрощается с сетевыми источниками, благодаря наличию ряда стандартных и свободных протоколов взаимодействия, однако многие источники всё же используют собственные протоколы: закрытые коммерческие или протоколы, завязанные на закрытые механизмы коммерческих операционных систем (ОС).
</p><p>В терминах OpenSCADA, предоставляются следующие объекты модели данных обслуживания механизма сбора данных:
</p>
<ul><li> "Атрибут" — объект отражения данных сигнала, включает текущее значение определённого типа сигнала и доступ к истории изменения этих значений;</li>
<li> "Параметр" — объект группы атрибутов со структурой, соответствующей особенностям отдельно взятого источника данных;</li>
<li> "Объект контроллера" — объект отдельного устройства данных. Как правило это отдельный модуль УСО или устройство промышленного ПЛК.</li></ul>
<p>Для учёта особенностей различных устройств сбора данных, а также различных механизмов взаимодействия, в OpenSCADA предусмотрена <a href="Program_manual.html#DAQ" title="Special:MyLanguage/Documents/Program manual">подсистема "Сбор данных"</a>, которая является модульной. В качестве модуля подсистемы выступает драйвер сопряжения с источником данных отдельного типа. Каждый модуль может содержать конфигурацию нескольких устройств этого типа в виде объектов контроллера. Общая схема объектов подсистемы "Сбор данных" изображена на рисунке 1.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:309px;"><a class="image" href="http://oscada.org/wiki/File:Oscada_subsys_daq_str_ru.png"><img class="thumbimage" height="335" src="files/Oscada_subsys_daq_str_ru.png" width="307" /></a>  <div class="thumbcaption">Рис. 1. Схема подсистемы "Сбор данных".</div></div></div></div>
<h2><span class="mw-headline" id=".D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B_.D1.81.D0.B1.D0.BE.D1.80.D0.B0_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="mw-headline-number">1</span> Методы сбора данных</span></h2>
<p>Учитывая различные свойства источников данных, а также возможные варианты взаимодействия, методы сбора данных можно разделить на: простой синхронный, простой асинхронный, пакетный и пассивный.
</p><p>В рассмотрении механизмов ниже будут участвовать следующие объекты:
</p>
<ul><li> "ObjectSCADA" — любой объект SCADA-системы, обращающийся за значением сигнала, например, архивы и визуализаторы;</li>
<li> "DAQParamAttribute" — атрибут параметра подсистемы "Сбор данных", выступающий посредником в доступе к значению сигнала источника данных;</li>
<li> "DAQParamAttributeArch" — объект архива атрибута;</li>
<li> "HardwarePLC" — объект источника данных, например, модули рассредоточенного УСО или промышленные ПЛК.</li></ul>
<h3><span class="mw-headline" id=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9_.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="mw-headline-number">1.1</span> Простой синхронный механизм сбора</span></h3>
<p>Механизм характеризуется запросами к источнику данных синхронно с запросом к атрибуту параметра (рис.2). Данный механизм обычно применяется при работе с локальными источниками данных, характеризующимися низкой латентностью, т.е. задержкой в ответе на запрос. С помощью этого метода можно получить актуальные данные непосредственно с запросом, однако время запроса объекта будет включать время транспортировки и обработки запроса источником данных.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:686px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_simpleSync.png"><img class="thumbimage" height="179" src="../en/files/DAQ_simpleSync.png" width="684" /></a>  <div class="thumbcaption">Рис. 2. Диаграмма последовательности взаимодействия при синхронных запросах.</div></div></div></div>
<p>В соответствии с диаграммой выше, мы получаем следующую последовательность запросов получения данных и их передачи:
</p>
<ul><li> объект SCADA-системы шлёт запрос значения к объекту атрибута параметра <b>DAQParamAttribute::getVal()</b>;</li>
<li> объект атрибута параметра, получив запрос, шлёт его источнику данных <b>HardwarePLC::valueRequest()</b>;</li>
<li> источник данных, обработав запрос, возвращает результат;</li>
<li> объект атрибута параметра, получив результат, возвращает его объекту SCADA-системы.</li></ul>
<p>В OpenSCADA такой механизм реализуют следующие модули подсистемы "Cбор данных":
</p>
<ul><li> <i><a href="Modules/JavaLikeCalc.html" title="Special:MyLanguage/Modules/JavaLikeCalc">JavaLikeCalc</a></i> — вычислитель на Java-подобном языке высокого уровня. В качестве источника данных выступает пользовательская программа на Java-подобном языке. Атрибуты параметров модуля синхронно обращаются к входам/выходам вычислительного контекста пользовательской функции.</li>
<li> <i><a href="Modules/LogicLev.html" title="Special:MyLanguage/Modules/LogicLev">LogicLev</a></i> — модуль логического уровня параметров сбора данных, детальнее о нём в разделе 3. В качестве источника данных этого модуля выступают другие параметры подсистемы "Сбор данных" и контекст исполнения шаблона параметров. Атрибуты параметров модуля синхронно обращаются к атрибутам других параметров, в режиме отражения параметров подсистемы "Сбор данных", или к входам/выходам контекста исполнения шаблона, в режиме работы по шаблону.</li>
<li> <i><a href="Modules/BlockCalc.html" title="Special:MyLanguage/Modules/BlockCalc">BlockCalc</a></i> — вычислитель на языке блочных схем. В качестве источника данных выступает пользовательская блочная схема. Атрибуты параметров модуля синхронно обращаются к входам/выходам блоков блочной схемы.</li>
<li> <i><a href="Modules/DAQGate.html" title="Special:MyLanguage/Modules/DAQGate">DAQGate</a></i> — модуль отражения объектов контроллеров удалённых OpenSCADA-станций на локальную. В модуле реализован синхронный режим записи данных.</li>
<li> <i><a href="Modules/ModBus.html" title="Special:MyLanguage/Modules/ModBus">ModBus</a></i> — модуль доступа к данным источников посредством семейства протоколов "ModBus". В модуле реализован синхронный режим записи данных.</li>
<li> <i><a href="Modules/DiamondBoards.html" title="Special:MyLanguage/Modules/DiamondBoards">DiamondBoards</a></i> — модуль доступа к данным PC/104 плат фирмы Diamond Systems. Платы PC/104 размещаются на ISA-шине, следовательно являются локальными и доступны сравнительно быстро. В режиме сбора данных не по прерыванию доступ к значениям АЦП осуществляется синхронно. Режим записи значения ЦАП всегда работает синхронно.</li></ul>
<h3><span class="mw-headline" id=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.BE.D0.B9_.D0.B0.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="mw-headline-number">1.2</span> Простой асинхронный механизм сбора</span></h3>
<p>Механизм характеризуется запросами к источнику данных независимо от запроса к атрибуту параметра (рис.3). Обычно, запросы к источнику данных осуществляются периодически, в собственной задаче опроса отдельно взятого контроллера и блоками по несколько сигналов. При этом, запросом к атрибуту параметра возвращается значение, полученное последним сеансом связи с источником данных. Данный механизм обычно применяется при работе с удалёнными (сетевыми) источниками данных, характеризующимися высокой латентностью, то есть задержкой в ответе на запрос. 
</p><p>С помощью этого метода можно обеспечить оптимизацию временного ресурса, затраченного на один сигнал, и тем самым увеличить максимальное количество опрашиваемых сигналов за интервал времени опроса.
</p><p>В качестве показательного примера рассмотрим промышленный ПЛК "Siemens S7-315", при опросе его по шине ProfiBus (1,5 Мбит/с). Среднее время обработки MPI-запроса этим контроллером составляет 30 мс. Если использовать синхронный механизм для каждого сигнала, т.е. один запрос на каждый сигнал, то в течении одной секунды мы сможем получить около 33 сигналов. А если применить асинхронный механизм, т.е. в одном MPI-пакете получать до 220 байт или 110 сигналов целочисленного типа на 16-разрядов, то мы сможем за одну секунду получить до 3630 сигналов. Как можно видеть, эффективность асинхронного механизма в данном случае составляет 110 раз, а именно значение максимальной ёмкости MPI-пакета. 
</p><p>Недостатком асинхронного механизма является то, что запрос значения атрибута параметра возвращает неактуальное на момент запроса значение, а значение последнего сеанса опроса контроллера. Впрочем, если учесть, что источник данных может обновляться с периодичностью аппаратных ограничений АЦП, да и сами датчики могут иметь определённые ограничения в скорости реакции, то применение асинхронного механизма сбора может иметь серьёзные основания.
</p><p>Применение асинхронного механизма для записи значений в ПЛК является достаточно редким явлением, поскольку запись значений обычно подразумевает влияние оператора на ТП. Оператор, по факту, достаточно редко вносит коррективы в процесс, следовательно запись можно выполнять синхронно. Однако, существуют ситуации, например, управление ТП регуляторами на SCADA-системе, выполняющей функции среды исполнения ПЛК.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:710px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_simpleAsync.png"><img class="thumbimage" height="279" src="../en/files/DAQ_simpleAsync.png" width="708" /></a>  <div class="thumbcaption">Рис. 3. Диаграмма последовательности взаимодействия при асинхронных запросах.</div></div></div></div>
<p>В соответствии с диаграммой выше, мы получаем следующую картину:
</p>
<ul><li> атрибут параметра, или вышестоящий объект контроллера, выполняет периодические запросы <b>HardwarePLC::valueRequest()</b> для получения значения сигнала или группы сигналов;</li>
<li> полученные значения сигналов размещаются локально в атрибутах параметров;</li>
<li> объект SCADA-системы шлёт запрос значения к атрибуту параметра <b>DAQParamAttribute::getVal()</b> и получает сохранённое локально значение предыдущего сеанса опроса источника данных.</li></ul>
<p>В OpenSCADA такой механизм реализуют следующие модули подсистемы "Cбор данных":
</p>
<ul><li> <i><a href="Modules/DAQGate.html" title="Special:MyLanguage/Modules/DAQGate">DAQGate</a></i> — модуль отражения объектов контроллеров удалённых OpenSCADA-станций на локальную. В модуле реализован асинхронный режим чтения данных.</li>
<li> <i><a href="Modules/System.html" title="Special:MyLanguage/Modules/System">System</a></i> — модуль доступа к данным окружения исполнения OpenSCADA. В модуле реализован асинхронный режим чтения данных.</li>
<li> <i><a href="Modules/ModBus.html" title="Special:MyLanguage/Modules/ModBus">ModBus</a></i> — модуль доступа к данным источников посредством семейства протоколов "ModBus". В данном модуле асинхронный режим реализован как для чтения данных, так и для их записи (опционально) на ПЛК.</li>
<li> <i><a href="Modules/SNMP.html" title="Special:MyLanguage/Modules/SNMP">SNMP</a></i> — модуль доступа к данным устройств сети посредством "Simple Network Management Protocol". В модуле реализован асинхронный режим чтения данных.</li>
<li> <i><a href="Modules/Siemens.html" title="Special:MyLanguage/Modules/Siemens">Siemens</a></i> — модуль доступа к данным контроллеров фирмы Siemens серии S7. В данном модуле асинхронный режим реализован как для чтения данных, так и для их записи (опционально) на ПЛК.</li></ul>
<h3><span class="mw-headline" id=".D0.9F.D0.B0.D0.BA.D0.B5.D1.82.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0"><span class="mw-headline-number">1.3</span> Пакетный механизм сбора</span></h3>
<p>Пакетный механизм сбора характерен сбором данных каждого сигнала пакетом, включающим историю его изменения. Т.е. за один сеанс опроса получается несколько значений истории сигнала. Пакетный механизм работает совместно с синхронным и асинхронными механизмами.
</p><p>В случае работы с синхронным механизмом, выполняется фактический переброс архива источника данных для оперативной работы в системе (рис. 2). Как и простой синхронный механизм, его желательно применять только на низколатентных источниках данных или с источниками, работа которых является сеансовой, например, в сфере коммерческого учёта для чтения значений счётчиков.
</p><p>При работе совместно с асинхронным механизмом, история полученных сигналов обычно прямо помещается в архивы (рис. 4), а текущее значение атрибута параметра устанавливается в последнее значение пакета. Данная комбинация эффективна при сборе быстрых данных или при синхронизации архивов после потери связи с удалённым источником данных.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:555px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_packAsync.png"><img class="thumbimage" height="267" src="../en/files/DAQ_packAsync.png" width="553" /></a>  <div class="thumbcaption">Рис. 4. Диаграмма последовательности взаимодействия при асинхронных запросах пакетного механизма.</div></div></div></div>
<p>В соответствии с диаграммой выше, мы получаем следующее поведение пакетного механизма при асинхронных запросах:
</p>
<ul><li> атрибут параметра, или вышестоящий объект контроллера, выполняет периодические запросы <b>HardwarePLC::valuesRequest()</b> получения пакетов значений сигнала или группы сигналов;</li>
<li> полученные пакеты значений сигналов помещаются в архив запросом <b>DAQParamAttributeArch::setValues()</b>, а последнее значение пакетов размещается в атрибуте параметра;</li>
<li> объект SCADA-системы шлёт запрос фрагмента архива к атрибуту параметра <b>DAQParamAttribute::getValues()</b>, а тот перенаправляет запрос к архиву <b>DAQParamAttributeArch::getValues()</b>. В результате, возвращается фрагмент архива, доступный после предыдущего сеанса опроса источника данных;</li>
<li> объект SCADA-системы шлёт запрос последнего значения к атрибуту параметра <b>DAQParamAttribute::getVal()</b> и получает сохранённое локально значение предыдущего сеанса опроса источника данных.</li></ul>
<p>В OpenSCADA такой механизм реализуют следующие модули подсистемы "Cбор данных":
</p>
<ul><li> <i><a href="Modules/DAQGate.html" title="Special:MyLanguage/Modules/DAQGate">DAQGate</a></i> — модуль отражения объектов контроллеров удалённых OpenSCADA-станций на локальную. Реализует синхронный и асинхронный пакетный режимы отражения архивов удалённых OpenSCADA-станций.</li>
<li> <i><a href="Modules/DiamondBoards.html" title="Special:MyLanguage/Modules/DiamondBoards">DiamondBoards</a></i> — модуль доступа к данным PC/104 плат фирмы Diamond Systems. Платы PC/104 размещаются на ISA-шине, следовательно являются локальными и доступны сравнительно быстро. В режиме сбора данных по прерыванию осуществляется ожидание пакетов быстрых значений (до 200 кГц) за одну секунду (до 200000 значений в пакете) и последующее размещение данных пакетов в архивах атрибутов параметров DAQ.</li></ul>
<h3><span class="mw-headline" id=".D0.9F.D0.B0.D1.81.D1.81.D0.B8.D0.B2.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D1.85.D0.B0.D0.BD.D0.B8.D0.B7.D0.BC_.D1.81.D0.B1.D0.BE.D1.80.D0.B0_.D0.B8_.D0.B8.D0.BD.D0.B8.D1.86.D0.B8.D0.B0.D1.82.D0.B8.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F"><span class="mw-headline-number">1.4</span> <span id="PassiveAndInitiative" title="#PassiveAndInitiative">Пассивный механизм сбора и инициативные подключения</span></span></h3>
<p>Пассивный механизм сбора характерен инициативой предоставления данных в SCADA-систему со стороны источника данных. Этот механизм является редким явлением, однако может иметь место в случае определённых условий или ограничений в возможности использования прямых механизмов сбора данных, рисунок 5. Примером такой ситуации могут служить географически рассредоточенные системы сбора данных посредством мобильных сетей GPRS/EDGE/3G/4G. В таких сетях, наделение всех клиентских узлов отдельными реальными и статическими IP-адресами или формирование корпоративной мобильной сети может оказаться дорогим удовольствием, поэтому доступнее оказывается инициатива сеанса передачи данных с клиентских динамических IP-адресов на один реальный IP-адрес сервера SCADA-системы. Воздействия на модификацию передаются источнику данных в момент сеанса передачи данных источником — читания.
Хотя, тут возможны типовые запросы через VPN подключение от источника данных и работа через сетевую СУБД-посредника.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:729px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_passive.png"><img class="thumbimage" height="190" src="../en/files/DAQ_passive.png" width="727" /></a>  <div class="thumbcaption">Рис.5. Диаграмма последовательности взаимодействия при пассивном механизме работы.</div></div></div></div>
<p>В соответствии с диаграммой выше, мы получаем следующее поведение пассивного механизма:
</p>
<ul><li> объект источника данных осуществляет периодические сеансы связи с атрибутом параметра <b>DAQParamAttributeArch::setVal()</b> для передачи своих данных и получения команд воздействия;</li>
<li> объект SCADA-системы шлёт запрос последнего значения атрибута параметра <b>DAQParamAttribute::getVal()</b> и получает сохранённое локально значение предыдущего сеанса связи источника данных.</li></ul>
<p>Промежуточным вариантом является инициатива установки TCP-подключения от источника данных и, далее осуществляются стандартные запросы по этому подключению от сервера, что входной транспорт <a href="Modules/Sockets.html" title="Special:MyLanguage/Modules/Sockets">модуля "Сокети"</a> на данный момент поддерживает. Основной библиотекой предоставляется <a href="../en/Libs_Main.html#initConsAssignTrs" title="Special:MyLanguage/Libs/Main">шаблон службы обработки ассоциативных выходных транспортов</a>, создаваемых для входных подключений.
</p><p>В случае когда хост, который инициирует подключение, имеет динамический адрес который не является "серым", т.е. по нему можно подключиться прямо, тогда инициативное подключение можно использовать только для получения обратного адреса, по которому прямо и подключаться, а в контроллере таких подключений осуществлять только обновление динамического адреса.
</p><p>OpenSCADA также поддерживает инициацию таких подключений, т.е. может выступать в роли источника данных за "серым" и динамическим IP. Так, входной транспорт <a href="Modules/Sockets.html" title="Special:MyLanguage/Modules/Sockets">модуля "Сокети"</a>, в режиме 2, выступает инициатором подключения после чего отправляет идентифицирующую последовательность и переходит в обычный режим получения запросов от хоста к которому подключился.
</p>
<h2><span class="mw-headline" id=".D0.92.D0.B8.D1.80.D1.82.D1.83.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.B8_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="mw-headline-number">2</span> <span id="Virtual" title="#Virtual">Виртуальные источники данных</span></span></h2>
<p>Кроме сбора физических данных, актуальной является функция виртуального сбора данных. Виртуальные данные представляют собой данные, полученные внутри системы как независимо, так и на основе физических данных. Практически, механизмы формирования виртуальных данных реализуются совместно с механизмом пользовательских вычислений. В среде промышленных контроллеров и SCADA-систем используются различные языки программирования. В случае с контроллерами, в качестве таких языков часто используются языки низкого уровня (ассемблеры), однако, в последнее время, всё чаще используются языки высокого уровня (C, Pascal и другие), а также формальные языки МЭК 61131-3 (схемы потоков состояний SFC, блочные схемы FBD, релейные схемы LD и текстовые ST, IL). В случае со SCADA-системами, вычисления чаще обеспечиваются языками программирования высокого уровня и формальными языками.
</p><p>В OpenSCADA могут быть реализованы интерфейсы программирования и виртуальных источников данных на основе различных языков, в отдельных модулях подсистемы "Сбор данных". На текущий момент доступны модули виртуальных вычислителей:
</p>
<ul><li> Вычислитель на Java-подобном языке: <a href="Modules/JavaLikeCalc.html" title="Special:MyLanguage/Modules/JavaLikeCalc">JavaLikeCalc</a>;</li>
<li> Блочный вычислитель: <a href="Modules/BlockCalc.html" title="Special:MyLanguage/Modules/BlockCalc">BlockCalc</a>.</li></ul>
<p>В ядро OpenSCADA интегрирован механизм пользовательских функций или <a href="User_API.html" title="Special:MyLanguage/Documents/User API">API пользовательского программирования</a>. Пользовательские функции могут предоставляться любым объектом программы, в том числе и модулями, в соответствии со своей функциональностью, тем самым предоставляя пользователю некий набор функций контроля за тем или иным объектом. Функции пользовательского API могут быть как статическими, т.е. реализующими фиксированную функциональность отдельного объекта, так и динамическими, т.е. формируемые пользователем под нужную ему задачу на внутреннем языке пользовательского программирования высокого уровня.
</p><p>Модуль <a href="Modules/JavaLikeCalc.html" title="Special:MyLanguage/Modules/JavaLikeCalc">JavaLikeCalc</a> предоставляет в OpenSCADA механизм создания динамических пользовательских функций и их библиотек на Java-подобном языке. Описание функции на Java-подобном языке заключается в обвязке параметров функции алгоритмом. Кроме этого, модуль наделен функциями непосредственных вычислений, путём создания вычислительных контроллеров с ассоциированной вычислительной функцией. Модулем предоставляется механизм прекомпиляции контекстно-зависимых функций, что используется для встраивания пользовательских алгоритмов непосредственно в контекст различных компонентов OpenSCADA, это, например, <a href="Program_manual.html#DAQ" title="Special:MyLanguage/Documents/Program manual">шаблоны параметров подсистемы "Сбор данных"</a> и <a href="Modules/VCAEngine.html" title="Special:MyLanguage/Modules/VCAEngine">движок среды визуализации и управления (СВУ)</a>.
</p><p>Модуль <a href="Modules/BlockCalc.html" title="Special:MyLanguage/Modules/BlockCalc">BlockCalc</a> предоставляет в OpenSCADA механизм создания пользовательских вычислений, который основывается на формальном языке блочных схем. Языки блочного программирования основываются на понятии блочных схем и функциональных блоков. Причём, в зависимости от сущности блока, блочные схемы могут быть: логическими схемами, схемами релейной логики, моделью технологического процесса и другое. Суть блочной схемы состоит в том, что она содержит список блоков и связи между ними. С формальной точки зрения блок — это элемент (функция), который имеет входы, выходы и алгоритм вычисления. Исходя из концепции среды программирования, блок — это кадр значений, ассоциированный с объектом функции. Входы и выходы блоков нужно соединять для получения цельной блочной схемы.
</p><p>С целью наполнения API пользовательского программирования функциями, созданы следующие специализированные модули статических функций API пользовательского программирования:
</p>
<ul><li> Библиотека функций системного API: <a href="Modules/FLibSYS.html" title="Special:MyLanguage/Modules/FLibSYS">FLibSYS</a>;</li>
<li> Библиотека стандартных математических функций: <a href="Modules/FLibMath.html" title="Special:MyLanguage/Modules/FLibMath">FLibMath</a>;</li>
<li> Библиотека функций совместимости со SCADA Complex1: <a href="Modules/FLibComplex1.html" title="Special:MyLanguage/Modules/FLibComplex1">FLibComplex1</a>.</li></ul>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:602px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_progCompon_ru.png"><img class="thumbimage" height="662" src="files/DAQ_progCompon_ru.png" width="600" /></a>  <div class="thumbcaption">Рис. 6. Общая структура компонентов среды программирования.</div></div></div></div>
<h2><span class="mw-headline" id=".D0.9B.D0.BE.D0.B3.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D1.83.D1.80.D0.BE.D0.B2.D0.B5.D0.BD.D1.8C_.D0.BE.D0.B1.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.BA.D0.B8_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="mw-headline-number">3</span> <span id="LogicLev" title="#LogicLev">Логический уровень обработки данных</span></span></h2>
<p>Выше мы отмечали, что тип источника данных может колебаться от "сырого" до комплексного. Под "сырым" подразумевается источник, который предоставляет только элементарные сигналы (целое, вещественное, логическое, строка, ...), причём отдельно. Под комплексным подразумевается источник, который группирует сигналы и, в параметре подсистемы "Сбор данных", предоставляет атрибуты дополнительного назначения, покрывающие практически все диагностические задачи, т.е. параметр является законченным объектом, не требующим дополнения.
</p><p>Учитывая такой разброс, может возникнуть ситуация, когда информации в параметре контроллера от источника данных недостаточно для описания реального объекта ТП в целом и нужен производный объект более высокого уровня абстракции. Решением этой ситуации может быть формирование дополняющих параметров, что является ненаглядным и вносит путаницу. Более правильным решением является использование прослойки "Логического уровня", выполняющей функции гибкого формирования параметров-контейнеров сигналов необходимой структуры и включающей пост-обработку.
</p><p>Функционально, "Логический уровень" предназначен для предоставления в OpenSCADA механизма свободного формирования параметров-контейнеров сигналов нужной структуры.
</p><p>Эксплуатационным назначением "Логического уровня" является:
</p>
<ul><li> расширение сферы применения OpenSCADA за счёт увеличения гибкости описания параметров подсистемы "Сбор данных";</li>
<li> сокращение трудозатрат на создание сложных автоматизированных систем.</li></ul>
<p>Концепция "Логического уровня" основана на шаблонах параметров, для которых, в подсистеме "Сбор Данных", предусмотрен контейнер библиотек шаблонов (рис.1). Каждая библиотека содержит шаблоны параметров, которые могут использоваться модулями подсистемы "Сбор Данных" для реализации параметров на основе шаблонов. Модулями OpenSCADA, которые используют шаблоны в своей работе, являются:
</p>
<ul><li> <a href="Modules/LogicLev.html" title="Special:MyLanguage/Modules/LogicLev">LogicLev</a> — модуль реализации классической концепции "Логического уровня".</li>
<li> <a href="Modules/ModBus.html" title="Special:MyLanguage/Modules/ModBus">ModBus</a> — модуль доступа к данным источников посредством семейства протоколов "ModBus". Кроме типа параметра прямого описания перечня регистров, модуль поддерживает и логический тип, где регистры "ModBus" описываются в связях шаблона.</li>
<li> <a href="Modules/Siemens.html" title="Special:MyLanguage/Modules/Siemens">Siemens</a> — модуль сбора данных контроллеров фирмы Siemens серии S7. Благодаря высокой гибкости и функциональности контроллеров этой серии, которая позволяет формировать комплексные типы данных различной структуры, все параметры этого модуля работают по шаблонам.</li></ul>
<p>Общий механизм работы "Логического уровня", на примере модуля <a class="new" href="http://oscada.org/wiki/index.php?title=LogicLev&amp;action=edit&amp;redlink=1" title="LogicLev (page does not exist)">LogicLev</a>, изображён на рисунке 7.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:296px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_loglevel_ru.png"><img class="thumbimage" height="360" src="files/DAQ_loglevel_ru.png" width="294" /></a>  <div class="thumbcaption">Рис. 7. Механизм работы "Логического уровня" на примере модуля "LogicLev".</div></div></div></div>
<p>Исходя из этого изображения видно, что параметры контроллера логического уровня выполняют функцию отражения других параметров подсистемы "Сбор данных" (на примере параметров 1 и 4) и произвольное формирование параметров на основе шаблонов 1, 2 и других параметров подсистемы "Сбор данных" (на примере параметров 2, 3 и 5).
</p><p>Структура параметров с шаблоном в основе имеет структуру, изображённую на рисунке 8.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:244px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_str_prmtmpl_ru.png"><img class="thumbimage" height="200" src="files/DAQ_str_prmtmpl_ru.png" width="242" /></a>  <div class="thumbcaption">Рис. 8. Структура параметров с шаблоном в основе.</div></div></div></div>
<p>Как можно видеть из структуры, параметр логического уровня состоит из объекта функции, атрибутов и конфигурации шаблона. Объект функции это экземпляр исполнения функции шаблона с набором входов/выходов и программой вычисления шаблона на одном из языков пользовательского программирования, обычно это Java-подобный язык пользовательского программирования модуля <a href="Modules/JavaLikeCalc.html" title="Special:MyLanguage/Modules/JavaLikeCalc">DAQ.JavaLikeCalc</a>. Впрочем, шаблон может быть вообще без программы, предоставляя только структуру проброса входов/выходов. Атрибуты в структуре изображают перечень атрибутов результирующего параметра в соответствии с шаблоном. Конфигурация в структуре предоставляет конфигурацию свойств шаблона и его внешних связей.
</p><p>Логику работы логического уровня параметров можно записать следующим образом:
</p>
<ul><li> Параметр связывается с шаблоном, из которого получается структура атрибутов, в соответствии с функцией шаблона.</li>
<li> Выполняется связывание объекта функции параметра с функцией из шаблона.</li>
<li> Формируется структура связей в соответствии с шаблоном функции. Исходя из структуры связей формируется форма связывания параметра и пользователем устанавливаются связи.</li>
<li> При доступе к атрибутам полученного параметра производится проверка на наличие прямой связи. В случае наличия прямой связи, запрос перенаправляется по этой связи, в противном случае, значение берётся из объекта функции параметра.</li>
<li> Параллельно работает вычисление функции шаблона по объекту функции параметров. При этом, перед вычислением, производится чтение значений по связям, а после вычисления запись изменений по этим связям.</li></ul>
<p>Шаблон параметров, в целом, предоставляет следующее:
</p>
<ul><li> структуру входов/выходов функции шаблона;</li>
<li> признаки конфигурации и связывания шаблона (константа, связь);</li>
<li> предварительные значения конфигурации постоянных и шаблонов связей;</li>
<li> признаки атрибутов результирующего параметра логического уровня, типов: не атрибут, атрибут с полным доступом, атрибут с доступом только на чтение; </li>
<li> механизм вычисления входов/выходов функции шаблонов языком пользовательского программирования OpenSCADA.</li></ul>
<p>На рисунке 9 представлено изображение вкладки конфигурации шаблона параметров подсистемы "Сбор данных" в виде таблицы с конфигурацией входов/выходов и текста программы пользовательского программирования.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:1044px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_prmtmpl_ru.png"><img class="thumbimage" height="724" src="files/DAQ_prmtmpl_ru.png" width="1042" /></a>  <div class="thumbcaption">Рис. 9. Вкладка конфигурации шаблона параметров подсистемы "Сбор данных".</div></div></div></div>
<p>Вкладкой входы/выходы "ВВ" шаблона параметра предусмотрены следующие свойства специализированного назначения: "Атрибут", "Конфигурация" и "Значение".
</p><p>Свойство "Атрибут" выступает признаком отражения входа/выхода шаблона на результирующий атрибут параметра. Предусмотрены следующие варианты этого свойства:
</p>
<ul><li> <i>Не атрибут</i> — вход/выход функции шаблона не отражается на атрибут;</li>
<li> <i>Только чтение</i> — вход/выход функции шаблона отражается на атрибут с доступом только на чтение;</li>
<li> <i>Полный доступ</i> — вход/выход функции шаблона отражается на атрибут с полным доступом.</li></ul>
<p>Свойство "Конфигурация" выступает признаком, указывающим на использование входа/выхода функции шаблона в результирующей конфигурации шаблона на логическом уровне. Предусмотрены следующие варианты этого свойства:
</p>
<ul><li> <i>Переменная</i> — доступен для доступа и контроля только из процедуры шаблона, как переменная, которая сохраняется с контекстом параметра логического уровня;</li>
<li> <i>Константа</i> — доступен для установки на уровне параметра логического уровня, в виде постоянной раздела конфигурации шаблона;</li>
<li> <i>Связь</i> — доступен для установки на уровне параметра логического уровня, в виде связи раздела конфигурации шаблона.</li></ul>
<p>Поле "Значение" описывает предустановленное значение для постоянных и шаблонов внешних связей. Шаблон внешних связей используется в целях описания механизма группировки и автоматического распределения внешних связей. Структура шаблона внешних связей однакова в части подключения к атрибутам параметров подсистемы "Сбор данных" и расширяется специфическим форматом адреса отдельного модуля подсистемы "Сбора данных", который использует механизм шаблонов. Подключение к параметрам подсистемы "Сбор данных" — шаблон конфигурации внешней связи имеет вид <b>{Параметр}|{атрибут}</b>, где
</p>
<ul><li> <i>Параметр</i> — используется для объединения атрибутов и помещения на форму конфигурации;</li>
<li> <i>атрибут</i> — для ассоциативного связывания атрибутов при назначении параметра. </li></ul>
<p><span id="LogicLevLnks" title="#LogicLevLnks">Само дальнейшее связывание</span> в целом может осуществляться:
</p>
<ul><li> общим определением-выбором адреса-атрибута параметра подсистемы "Сбор данных";</li>
<li> определением специфического адреса отдельного модуля подсистемы "Сбор данных";</li>
<li> прямой установкой постоянного значения в формате "<b>val:{Постоянная}</b>";</li>
<li> пустым или ошибочным адресом, когда значение по связи устанавливается в <b>EVAL</b>.</li></ul>
<p>В качестве примера использования шаблона на рисунке 10 приведено изображение параметра "F3" модуля логического уровня, где представлена вкладка "Конфигурация шаблона" для конфигурации шаблона параметра, включая связывание. На рисунке 11 представлена вкладка "Атрибуты" с перечнем атрибутов и их значений, созданных посредством шаблона.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:869px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_wprm_tmpl_ru.png"><img class="thumbimage" height="606" src="files/DAQ_wprm_tmpl_ru.png" width="867" /></a>  <div class="thumbcaption">Рис. 10. Вкладка "Конфигурация шаблона" параметра "F3" модуля логического уровня.</div></div></div></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:915px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_wprm_a_ru.png"><img class="thumbimage" height="690" src="files/DAQ_wprm_a_ru.png" width="913" /></a>  <div class="thumbcaption">Рис. 11. Вкладка "Атрибуты" параметра "F3" модуля логического уровня.</div></div></div></div>
<h3><span class="mw-headline" id=".D0.9A.D0.BE.D0.BD.D1.86.D0.B5.D0.BF.D1.86.D0.B8.D1.8F_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BA_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D0.BC_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B8.D0.B9_.D0.BF.D1.80.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.BB"><span class="mw-headline-number">3.1</span> <span id="UserPrt" title="#UserPrt">Концепция доступа к данным через пользовательский протокол</span></span></h3>
<p>Следующим уровнем, основанным на Логическом Уровне, является концепция доступа к данным через пользовательский протокол, что реализуется или прямо в коде шаблона или как отдельный объект Пользовательского Протоколу в <a href="Modules/UserProtocol.html" title="Special:MyLanguage/Modules/UserProtocol">модуле Protocol.UserProtocol</a>, где, на данный момент, также можно использовать DAQ-шаблоны.
</p><p>Концепцию доступа к данным через пользовательский протокол можно изобразить как на рисунке 1.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:324px;"><a class="image" href="http://oscada.org/wiki/File:UserPrtDevs_concept_ru.png"><img class="thumbimage" height="275" src="files/UserPrtDevs_concept_ru.png" width="322" /></a>  <div class="thumbcaption">Рис.1. Концепция доступа к данным через пользовательский протокол.</div></div></div></div>
<p>Как можно видеть с рисунка 1, взаимодействие с устройством происходит через некоторый транспорт на котором они физически базируются. Запрос к транспорту Вы можете отправить:
</p>
<ol><li> Непосредственно с помощью функции системного API OpenSCADA объекта транспорта <i><a href="User_API.html#SYSTransport" title="Special:MyLanguage/Documents/User API">string messIO( string mess, real timeOut = 0 );</a></i>, если протоколоспецифическая часть очень проста и данные Вам нужно лишь извлечь.</li>
<li> Завёрнутый запрос данных <i>req</i>, функцией <i><a href="User_API.html#SYSTransport" title="Special:MyLanguage/Documents/User API">int messIO( XMLNodeObj req, string prt );</a></i> и для протокола <i>prt</i>, если протокольная часть достаточно сложная и уже представлена в OpenSCADA.</li>
<li> Завёрнутый запрос данных специфический к пользователю с помощью функции <i><a href="User_API.html#SYSTransport" title="Special:MyLanguage/Documents/User API">int messIO( XMLNodeObj req, "UserProtocol" );</a></i> и реализации <a href="Modules/UserProtocol.html" title="Special:MyLanguage/Modules/UserProtocol">пользовательского протокола</a>, если протокольная часть достаточно сложная и ещё отсутствует в OpenSCADA. Пользователь реализует тут саму протоколоспецифическую часть в <a href="Modules/UserProtocol.html" title="Special:MyLanguage/Modules/UserProtocol">модуле UserProtocol</a> и часть специфическую к данным в шаблоне для <a href="Modules/LogicLev.html" title="Special:MyLanguage/Modules/LogicLev">модуля Логического Уровня</a> или непосредственно в процедуре контролера на внутреннем языке программирования <a href="Modules/JavaLikeCalc.html" title="Special:MyLanguage/Modules/JavaLikeCalc">модуля JavaLikeCalc</a>.</li></ol>
<dl><dd><dl><dd> <a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../en/files/At.png" width="22" /></a> Этот последний метод развит к возможности формирования протокольной части кода непосредственно в том-же коде шаблона, как отдельная встроенная функция через вызовом функции запроса первого метода, если нет необходимости повторного использования, или даже если такая необходимость есть и тут имеет смысл создание комплексного шаблона, который сможет объединять роль и выходного протокола, через его подключение также к модулю пользовательского протокола. И оно будет полностью храниться в одной библиотеке шаблонов. </dd></dl></dd></dl>
<p><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../en/files/At.png" width="22" /></a> Прямая работа с выходным транспортом функции <a href="User_API.html#SYSTransport" title="Special:MyLanguage/Documents/User API">string messIO( string mess, real timeOut = 0 );</a> не предусматривает блокирования транспорта поза вызовом этой функции, а соответственно, для сложных протоколов с посылками ответа более чем в одном пакете, что предусматривает процесс "дожидания", не можно использовать общий транспорт, по которому возможна отправка пакетов различных протоколов или даже один, но в различных задачах (объектах контроллеров). Соответственно, если есть необходимость использования совместного транспорта, то размещайте параметры опроса по протоколу в одном объекте контроллера (задаче) или используйте <a href="Modules/UserProtocol.html" title="Special:MyLanguage/Modules/UserProtocol">модуль пользовательского протокола</a>, к которому это замечание не имеет отношения, поскольку он осуществляет такое блокирование на время вызова процедуры обработки, как и остальные модульные протоколы OpenSCADA. 
</p><p>Созданы следующие библиотеки с использованием концепции доступа к данным через пользовательский протокол:
</p>
<ul><li> <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Libs/Devices" title="Special:MyLanguage/Libs/Devices">Библиотека промышленных устройств</a></li>
<li> <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Libs/LowLevelDevices" title="Special:MyLanguage/Libs/LowLevelDevices">Библиотека низкоуровневых сенсоров и чипов</a></li></ul>
<h2><span class="mw-headline" id=".D0.A0.D0.B5.D0.B7.D0.B5.D1.80.D0.B2.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.BE.D0.B2_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="mw-headline-number">4</span> <span id="Redundancy" title="#Redundancy">Резервирование источников данных</span></span></h2>
<p>Резервирование вообще, и источников данных в частности, служит для повышения общего уровня отказоустойчивости решения путём включения дублирующих узлов в совместную работу с основным узлом. В случае сбоя основного узла происходит подхват функций основного узла резервным. Часто, схема резервирования может работать и в режиме распределения нагрузки между совместно работающими узлами.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:515px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_red_ru.png"><img class="thumbimage" height="351" src="files/DAQ_red_ru.png" width="513" /></a>  <div class="thumbcaption">Рис. 12. Горизонтальное и вертикальное резервирование.</div></div></div></div>
<p>В случае с подсистемой "Сбор данных", резервирование данных (рис.12) выполняет функции:
</p>
<ul><li> <b>Резервирование механизма сбора данных</b>. Обычно эта функция реализуется без особых механизмов, путём простого запуска параллельных резервных станций с одинаковой конфигурацией и работающих независимо. Однако, в случае выполнения станцией функции ПЛК, такое поведение недопустимо по причине одновременной выдачи управляющих воздействий и отсутствия синхронизации данных вычислителей.</li>
<li> <b>Компенсация потери данных на время простоя узла</b> за счёт архива резервного. Предусмотрены два механизма компенсации. Первый и основной механизм осуществляет загрузку участков архива из резервной станции в момент запуска станции в целом или отдельных объектов контроллеров. Участок архива запрашивается с момента последней записи в локальном архиве и по текущее время. Глубина запроса, при этом, ограничивается указанием предельного времени в конфигурации резервирования. Второй, дополняющий механизм, осуществляет заполнение "дыр" в архиве значений в момент фактического запроса пользователя к этим данным. Такой подход, с одной стороны, позволяет осуществить прогнозируемую по времени синхронизацию при старте, а с другой стороны, фактически исключает потерю данных при условии работы хотя бы одной станции в течение всего рабочего времени.</li>
<li> <b>Распределение нагрузки по сбору данных между узлами</b>. При создании сложных распределённых систем может оказаться важным вопрос прогнозирования и оптимизации общей производительности системы. С учётом таких задач, механизм резервирования предусматривает исполнение задач сбора данных отдельных источников (объектов контроллеров OpenSCADA) только на одной станции. При этом, задачи остальных станций переходят в режим синхронизации данных с исполняющей станцией. В случае потери связи с исполняющей станцией, запускается задача локального сбора данных. Предусмотрена, также, возможность оптимального распределение нагрузки исполнения задач сбора данных группы объектов контроллеров, между станциями.</li>
<li> <b>Оптимизация нагрузки на внешние источники данных</b> за счёт запроса (обмена) данных у внешнего источника только одним узлом. На практике часто встречаются высоко-нагруженные источники данных, или интерфейсы доступа к источникам данных, для которых даже сбор данных одной станцией может быть проблемой и потребует снижения периодичности сбора, т.е. качества данных. Механизм резервирования, кроме распределения нагрузки между станциями по описанной выше схеме, позволяет снять дополнительную нагрузку на источник данных и его интерфейсы, тем самым повысив качество данных. Запись в атрибуты резервного объекта контроллера приводит к отправке запроса модификации на основной, т.е. — через основной.</li>
<li> <b>Предотвращение некоторого отличия данных на разных узлах</b>, связанное с несовпадением моментов времени при независимом сборе данных отдельными узлами, осуществляется путём получения данных у станции с активным объектом контроллера. В системах высокой отчётности с резервированием должно быть исключено, или сведено к минимуму, расхождение в данных на разных станциях, что подразумевает реальный сбор данных одной станцией и синхронизацию с этими данными остальных станций.</li></ul>
<p>Резервирование рекомендуется настраивать таким образом чтобы БД резервных станций сохранялись одинаковыми, что в дальнейшем позволит безболезненно копировать их, при восстановлении, на любую станцию и, соответственно, в резервной копии можно хранить только один набор БД. При этом, настройки, специфичные для отдельной станции, будут сохраняться в конфигурационном файле и можно будет легко конфигурировать и менять нужную станцию через выбор соответствующего конфигурационного файла.
</p><p>Настройка резервирования начинается с добавления резервных станций в список станций OpenSCADA на вкладке "Подсистема" подсистемы "Транспорты" (Рис.13). Причём, добавлять тут нужно не только резервные станции к текущей, но и саму эту текущую станцию с её внешним адресом, т.е. своеобразная петля. В дальнейшем эти настройки будут сохранены в общую БД резервированной системы и сама БД с этого момента будет использоваться при создании всех резервных станций. Соответственно важно на этом этапе внести все нужные изменения в общую БД вокруг проекта в целом!
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:974px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_tr_extHst_ru.png"><img class="thumbimage" height="450" src="files/DAQ_tr_extHst_ru.png" width="972" /></a>  <div class="thumbcaption">Рис. 13. Вкладка "Подсистема" подсистемы "Транспорты".</div></div></div></div>
<p>Далее, на конкретной станции с копией общей БД, настраиваем её специфические параметры во вкладке "Резервирование" главной страницы (Рис.14), которые будут сохранены в конфигурационном файле.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:778px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_sys_rd_ru.png"><img class="thumbimage" height="589" src="files/DAQ_sys_rd_ru.png" width="776" /></a>  <div class="thumbcaption">Рис. 14. Вкладка "Резервирование" главной страницы.</div></div></div></div>
<p>После этого вся конфигурация резервирования осуществляется во вкладке "Резервирование" подсистемы "Сбор данных" (Рис.15). Если установить параметр "Передача локальных первичных команд" (Рис.14) то эта конфигурация, как и любая другая общего характера, может осуществляться на одной из станций, а внесённые изменения попадут на все резервные, конечно если они будут доступны.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:933px;"><a class="image" href="http://oscada.org/wiki/File:DAQ_rd_ru.png"><img class="thumbimage" height="589" src="files/DAQ_rd_ru.png" width="931" /></a>  <div class="thumbcaption">Рис. 15. Вкладка "Резервирование" подсистемы "Сбор данных".</div></div></div></div>
<p>Задача обслуживания механизма резервирования запускается всегда и исполняется с периодичностью, установленной в соответствующем конфигурационном поле. Реальная работа по осуществлению резервирования осуществляется при наличии хотя бы одной резервной станции в списке станций и предполагает:
</p>
<ul><li> Контроль за соединением с внешними станциями. В процессе контроля осуществляются запросы к удалённым станциям, за обновлением информации о них и проверки связи. В случае потери связи со станцией, повтор подключения к ней осуществляется через промежуток времени, указанный в конфигурационном поле интервала времени восстановления соединения. В поле "Жив", станции, отображается текущее состояние связи. В поле "Счётчик" представлено количество запросов, осуществлённых к удалённой станции, или же время, оставшееся до осуществления следующей попытки соединения с потерянной станции.</li>
<li> Локальное планирование исполнения объектов контроллеров в резерве. Планирование осуществляется в соответствии с уровнями станций и предпочтениями исполнения объектов контроллеров.</li>
<li> Вызов функции синхронизации данных локальных объектов контроллеров, работающих в режиме синхронизации данных из внешних станций.</li></ul>
<p>Для контроля за временем, затраченным на выполнение цикла обслуживания резервирования, предусмотрено поле статуса. При приближении реального времени выполнения к циклу задачи обслуживания резервирования, рекомендуется увеличить периодичность исполнения этой задачи!
</p><p>Для объекта контроллера подсистемы "Сбор данных" предусмотрены режимы резервирования "Асимметричное" и "Только нарушения". Асимметричное резервирование работает с той конфигурацией контроллера удалённой станции, какая есть и не пытается её обобщать. Для этого режима работают все ранее описанные функции и свойства резервирования. Резервирование "Только нарушения" предусматривает фактическую работу без резервирования, но с подавлением нарушений от резервного объекта контроллера с целью исключения дублирующих сообщений о нарушениях.
</p>
<h2><span class="mw-headline" id=".D0.9C.D0.B5.D1.82.D0.BA.D0.B0_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D0.B8.D1.81.D1.82.D0.BE.D1.87.D0.BD.D0.B8.D0.BA.D0.B0_.D0.B4.D0.B0.D0.BD.D0.BD.D1.8B.D1.85"><span class="mw-headline-number">5</span> <span id="TimeStamp" title="#TimeStamp">Метка времени источника данных</span></span></h2>
<p>Фактически все источники данных, которые поддерживаются OpenSCADA, в качестве метки времени оперативных-текущих данных используют время компьютера где работает OpenSCADA и осуществляется опрос этого источника данных, даже в случае возможности получения времени сервера или источника у источника данных, и часто даже в случае когда таким источником выступает другая станция-ПЛК из OpenSCADA.
</p><p>Такой подход определён с нескольких причин, а именно:
</p>
<ul><li> различение и выделение отличия времени оперативных значений источника данных и ПК сбора данных не имеет ни одной практической цели кроме диагностической с выявления самого расхождения времени, поскольку текущие данные архивируются в архив периодических значений, где метка времени так или иначе притягивается и округляется к этой периодичности, т.е. часть времени точнее за период данных архива теряется;</li>
<li> редко какой источник данных вообще имеет часы реального времени, а когда и имеет то до него сразу ставится требование синхронизации времени с внешним источником образцового времени, что в свою очередь требует разрешения сложностей с прямым подключением GPS приёмника или доступом к NTP-серверу в интернет или локальной сети; согласно-же этого подхода образцовым временем становится время ПК сбора данных, даже когда он сам не синхронизирован, поскольку он один;</li>
<li> метка времени источника данных может меняться с собственной периодичностью или это обновление вообще может быть апериодическим, что в случае использования этой метки при опросе приведёт к пробелам в архиве, и даже когда периодичности опроса-архивирования и обновления метки времени источника одинаковы такие пробелы будут иметь место из-за отсутствия синхронности, что придётся компенсировать уменьшением периодичности опроса и, соответственно, увеличением нагрузки на сеть и источник; итак это сделает архив мало полезным, хотя сейчас предоставляется возможность считать такие пробелы (проходные) не фактом отсутствия или ошибочностью данных.</li></ul>
<p>На данный момент известен один способ, когда от метки времени источника данных есть практическая ценность, это работа с историей-архивом на стороне источника данных, когда при обнаружении пробелов в данных, например, на время отсутствия связи, вместо текущих-оперативных данных запрашивается участок истории-архива, который соответствует этому пробелу. И этот метод реализован в модуле <a href="Modules/DAQGate.html" title="Special:MyLanguage/Modules/DAQGate">DAQ.DAQGate</a>, при работе OpenSCADA на стороне источника данных или ПЛК.
</p>
<h2><span class="mw-headline" id=".D0.A1.D1.81.D1.8B.D0.BB.D0.BA.D0.B8"><span class="mw-headline-number">6</span> Ссылки</span></h2>
<ul><li> <a class="external" href="http://oscada.org/wiki/File:Oscada_subsys_daq_str_ru.odg" title="File:Oscada subsys daq str ru.odg">Диаграмма: Иерархическая структура подсистемы "Сбор данных".</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Daq.xmi.gz" title="File:Daq.xmi.gz">UML: Диаграммы последовательности подсистемы "Сбор Данных".</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Daq_loglevel_ru.dia" title="File:Daq loglevel ru.dia">Диаграмма: Механизм работы "Логического уровня" на примере модуля LogicLev.</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Loglev_prm_ru.dia" title="File:Loglev prm ru.dia">Диаграмма: Структура параметра логического уровня.</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Daq_progcompon_ru.dia" title="File:Daq progcompon ru.dia">Диаграмма: Общая структура компонентов среды программирования.</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:UserPrtDevs_concept_ru.odg" title="File:UserPrtDevs concept ru.odg">Диаграмма: Концепция доступа к данным через пользовательский протокол.</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Daq_red_ru.odg" title="File:Daq red ru.odg">Диаграмма: Горизонтальное и вертикальное резервирование.</a></li></ul>






</div><table style="border-top: dotted 2px #999999; margin-top: 20pt; color: gray;" width="100%"><tr><td style="text-align: left;" width="40%"><a href="http://oscada.org/wiki/Documents/DAQ/ru">Documents/DAQ/ru</a> - <a href="http://oscada.org/en/main/about-the-project/licenses/">GFDL</a></td><td style="text-align: center;">March 2020</td><td style="text-align: right;" width="40%">OpenSCADA 1+r2667</td></tr></table></body>
</html>