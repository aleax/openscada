<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html class="client-nojs" dir="ltr" lang="en">
<head>
<title>Модули/Архивация на ФС - OpenSCADAWiki</title>
<meta content="MediaWiki 1.26.4" name="generator" />
<link href="https://www.gnu.org/copyleft/fdl.html" rel="copyright" />
<link href="../files/doc.css" rel="stylesheet" /></head>
<body><div id="mw_header">
			<div class="mw-indicators">
</div>
			<h1 id="firstHeading" lang="ru">Модули/Архивация на ФС</h1>
		</div><div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="ru"><div class="mw-pt-translate-header noprint" dir="ltr" lang="en">This page is a <span class="plainlinks"><a class="external text" href="http://oscada.org/wiki/index.php?title=Special:Translate&amp;group=page-Modules%2FFSArch&amp;action=page&amp;filter=&amp;language=ru" rel="nofollow noreferrer noopener" target="_blank">translated version</a></span> of the page <a class="external" href="http://oscada.org/wiki/Modules/FSArch" title="Modules/FSArch">Modules/FSArch</a> and the translation is 100% complete.</div><hr /><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><div class="mw-pt-languages-list autonym"><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/FSArch" title="Modules/FSArch (100% translated)">English</a>&nbsp;• ‎<span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete">российский</span>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/FSArch/uk" title="Модулі/Архівація на ФС (100% translated)">українська</a></div></div>
<div class="noprint" style="float:right; border:1px solid gray; width:300px; background-color:ivory; padding:2px;">
<table cellspacing="0">
<tr>
<td> <a class="image" href="http://oscada.org/wiki/File:Constr.png"><img alt="Constr.png" height="32" src="../files/Constr.png" width="32" /></a>
</td>
<td style="padding-left:5px;"> The translation checking and actualizing
</td></tr></table>
</div>
<table class="wikitable">

<tr>
<th> Модуль </th>
<th> Имя </th>
<th> Версия </th>
<th> Лицензия </th>
<th> Источник </th>
<th> Языки </th>
<th> Платформы </th>
<th> Тип </th>
<th> Автор </th>
<th> Описание
</th></tr>

<tr>
<td> <a href="../Modules/FSArch.html" title="Special:MyLanguage/Modules/FSArch">FSArch</a> </td>
<td> Архиватор на файловую систему </td>
<td> 2.10 </td>
<td> GPL2 </td>
<td> arh_FSArch.so </td>
<td> en,uk,ru,de </td>
<td> x86,x86_64,ARM
</td>
<td> Архив </td>
<td> Роман Савоченко </td>
<td> Модуль архиватора. Предоставляет функции архивирования сообщений и значений на файловую систему.
</td></tr></table>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.D0.90.D1.80.D1.85.D0.B8.D0.B2.D0.B0.D1.82.D0.BE.D1.80_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D0.B9"><span class="tocnumber">1</span> <span class="toctext">Архиватор сообщений</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#.D0.A4.D0.BE.D1.80.D0.BC.D0.B0.D1.82_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D0.B9"><span class="tocnumber">1.1</span> <span class="toctext">Формат файлов архива сообщений</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#.D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D1.8F"><span class="tocnumber">1.2</span> <span class="toctext">Пример файла архива сообщения</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#.D0.90.D1.80.D1.85.D0.B8.D0.B2.D0.B0.D1.82.D0.BE.D1.80_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9"><span class="tocnumber">2</span> <span class="toctext">Архиватор значений</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#.D0.A4.D0.BE.D1.80.D0.BC.D0.B0.D1.82_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9"><span class="tocnumber">2.1</span> <span class="toctext">Формат файлов архива значений</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#.D0.AD.D1.84.D1.84.D0.B5.D0.BA.D1.82.D0.B8.D0.B2.D0.BD.D0.BE.D1.81.D1.82.D1.8C"><span class="tocnumber">3</span> <span class="toctext">Эффективность</span></a></li>
</ul>
</div>

<p>Модуль предназначен для архивирования сообщений и значений системы OpenSCADA на файловую систему.
</p><p>Любая SCADA система предоставляет возможность архивирования собранных данных, т.е. формирование истории изменения (динамики) процессов. Архивы условно можно разделить на два типа: архивы сообщений и архивы значений.
</p><p>Особенностью архивов сообщений является то, что архивируются, так называемые, события. Характерным признаком события является его время возникновения. Архивы сообщений обычно используются для архивирования сообщений в системе, т.е. ведение логов и протоколов. В зависимости от источника сообщения могут классифицироваться по различным критериям. Например, это могут быть протоколы аварийных ситуаций, протоколы действий операторов, протоколы сбоев связи и др.
</p><p>Особенностью архивов значений является их периодичность, определяемая промежутком времени между двумя смежными значениями. Архивы значений применяются для архивирования истории непрерывных процессов. Поскольку процесс непрерывный, то и архивировать его можно только путём введения понятия квантования времени опроса, поскольку иначе мы получаем архивы бесконечных размеров ввиду непрерывности самой природы процесса. Кроме этого, практически мы можем получать значения с периодом ограниченным самими источниками данных. Например, довольно качественные источники данных, в промышленности, редко позволяют получать данные с частотой более 1кГц. И это без учёта самих датчиков, имеющих ещё менее качественные характеристики.
</p><p>Для ведения архивов в системе OpenSCADA предусмотрена подсистема "Архивы". Данная подсистема, в соответствии с типами архивов, состоит из двух частей: архив сообщений и архивы значений. Подсистема в целом является модульной, что позволяет создавать архивы, основанные на различной природе и способах хранения данных. Данный модуль предоставляет механизм архивирования на файловую систему как для потока сообщений, так и для потока значений.
</p>
<h2><span class="mw-headline" id=".D0.90.D1.80.D1.85.D0.B8.D0.B2.D0.B0.D1.82.D0.BE.D1.80_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D0.B9"><span class="mw-headline-number">1</span> Архиватор сообщений</span></h2>
<p>Архивы сообщений формируются архиваторами. Архиваторов может быть множество с индивидуальными настройками, позволяющими разделять архивирование различных классов сообщений.
</p><p>Архиватор сообщений этого модуля позволяет хранить данные как в файлах формата языка XML, так и в формате плоского текста. Язык разметки XML является стандартным форматом, который с лёгкостью понимают многие сторонние приложения. Однако открытие и разбор файлов в таком формате требует значительных ресурсов. С другой стороны, формат плоского текста требует значительно меньше ресурсов, хотя и не является унифицированным, а также требует знания его структуры для разбора.
</p><p>В любом случае поддерживаются оба формата и пользователь может выбрать любой из них, в соответствии со своими требованиями.
</p><p>Файлы архивов именуются архиваторами, исходя из даты первого сообщения в архиве. Например, так: "2006-06-21 17:11:04.msg".
</p><p>Файлы архивов могут ограничиваться по размеру и времени. После превышения лимита создаётся новый файл. Максимальное количество файлов в директории архиватора также может быть ограничено. После превышения лимита на количество файлов, старые файлы начнут удаляться!
</p><p>С целью оптимизации использования дискового пространства архиваторы поддерживают упаковку старых архивов упаковщиком gzip. Упаковка производится после продолжительного неиспользования архива.
</p><p>При использовании архивов в формате языка XML соответствующие файлы загружаются целиком! Для выгрузки неиспользуемых продолжительное время архивов применяется таймаут доступа к архиву, после превышения которого архив выгружается из памяти, а затем и пакуется.
</p><p>Модулем предоставляются дополнительные параметры настройки процесса архивирования (рис.1).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:898px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_mess_a_prm_ru.png"><img class="thumbimage" height="711" src="../files/FSArch_mess_a_prm_ru.png" width="896" /></a>  <div class="thumbcaption">Рис.1. Дополнительные параметры настройки процесса архивирования сообщений.</div></div></div></div>
<p>В число этих параметров входят:
</p>
<ul><li> <i>Файлы архивов в XML</i> — Включает архивирование сообщений в файлы XML-формата, вместо плоского текста. Использование в архивировании XML-формата требует больше оперативной памяти поскольку необходима полная загрузка файла, XML-разбор и хранение в памяти на момент использования.</li>
<li> <i>Максимальный размер файла архива, в килобайтах</i> — Устанавливает ограничение на размер одного файла архива. Отключить ограничение можно установив параметр в ноль.</li>
<li> <i>Максимальное количество файлов</i> — Ограничивает максимальное количество файлов архива и совместно с размером отдельного файла определяет размер архива на диска. Полностью снять это ограничение можно установив параметр в ноль.</li>
<li> <i>Размер файла по времени, в днях</i> — Устанавливает ограничение на размер одного файла архива по времени.</li>
<li> <i>Таймаут упаковки файлов, в минутах</i> — Устанавливает промежуток времени по истечению которого, и в случае отсутствия обращений, файлы архивов будут упаковываться gzip архиватором. Установить в ноль для отключения упаковки gzip.</li>
<li> <i>Период проверки архивов, в минутах</i> — Устанавливает периодичность проверки архивов на предмет появления или удаления в директории файлов архивов, а также превышение лимитов и удаление старых файлов архивов.</li>
<li> <i>Использовать информационный файл для упакованных архивов</i> — Указывает на необходимость создания файла с информацией о запакованных gzip-архиватором файлах архива. При копировании файлов архива на другую станцию этот информационный файл позволяют ускорить процесс первого запуска целевой станции за счёт исключения необходимости распаковки gzip-архивов для целью получения информации.</li>
<li> <i>Предотвращать дубликаты</i> — Включает проверку на наличие дублирующих сообщений в момент помещения сообщения в архив. При наличии дубликата сообщение не помещается в архив. Данная функция несколько повышает время записи в архив, но в случаях помещения сообщений в архив обратным числом из внешних источников позволяет исключить дублирование.</li>
<li> <i>Считать дубликатами и предотвращать с равным временем, категорией, уровнем</i> — Включает проверку на наличие дублирующих сообщений в момент помещения сообщения в архив. Дублирующими считаются сообщения с равным временем, категорией и уровнем. Новое дублирующее сообщение заменяет в архиве старое. Данная функция в основном полезна для изменения текста записи сообщения, например, для статуса нарушения.</li>
<li> <i>Проверить директорию архиватора сейчас</i> — Команда, которая позволяет запустить проверку архивов немедленно, например, после ручного изменения в директории архиватора.</li></ul>
<p>Для контроля за файлами архиватора Вы можете посмотреть во вкладке "Файлы" (рис. 2).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:1085px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_mess_files_ru.png"><img class="thumbimage" height="717" src="../files/FSArch_mess_files_ru.png" width="1083" /></a>  <div class="thumbcaption">Рис.2. Вкладка "Файлы" объекта архиватора сообщений.</div></div></div></div>
<h3><span class="mw-headline" id=".D0.A4.D0.BE.D1.80.D0.BC.D0.B0.D1.82_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D0.B9"><span class="mw-headline-number">1.1</span> Формат файлов архива сообщений</span></h3>
<p>В таблице ниже приведен синтаксис файла архива, построенного на XML-языке:
</p>
<table class="wikitable">

<tr>
<th> Тег </th>
<th> Описание </th>
<th> Атрибуты </th>
<th> Содержит
</th></tr>
<tr>
<td> FSArch </td>
<td> Корневой элемент. Идентифицирует файл как принадлежащий данному модулю. </td>
<td>
<p><i>Version</i> — версия файла архива;<br />
<i>Begin</i> — время начала архива (hex - UTC в секундах от 01/01/1970);<br />
<i>End</i> — время окончания архива (hex - UTC в секундах от 01/01/1970).
</p>
</td>
<td> (m)
</td></tr>
<tr>
<td> m </td>
<td> Тег отдельного сообщения. </td>
<td>
<p><i>tm</i> — время создания сообщения (hex - UTC в секундах от 01/01/1970);<br />
<i>tmu</i> — микросекунды времени сообщения;<br />
<i>lv</i> — уровень сообщения;<br />
<i>cat</i> — категория сообщения.
</p>
</td>
<td> Текст сообщения
</td></tr></table>
<p>Архивный файл на основе плоского текста состоит из:
</p>
<ul><li> заголовка в формате: "<b>FSArch {vers} {charset} {beg_tm} {end_tm}</b>"; Где:
<ul><li> <i>vers</i> — версия модуля архивирования;</li>
<li> <i>charset</i> — кодировка файла (обычно UTF-8);</li>
<li> <i>beg_tm</i> — UTC время начала архива с эпохи 01.01.1970 в шестнадцатеричной форме;</li>
<li> <i>end_tm</i> — UTC время конца файла архива с эпохи 01.01.1970 в шестнадцатеричной форме.    </li></ul></li>
<li> записей сообщений в формате: "<b>{tm} {lev} {cat} {mess}</b>"; Где:
<ul><li> <i>tm</i> — время сообщения в виде: <b>{utc_sec}:{usec}</b>, где:
<ul><li> <i>utc_sec</i> — UTC время с эпохи 01.01.1970 в шестнадцатеричной форме;</li>
<li> <i>usec</i> — микросекунды времени в десятичной форме.</li></ul></li>
<li> <i>lev</i> — уровень важности сообщения;</li>
<li> <i>cat</i> — категория сообщения;</li>
<li> <i>mess</i> — текст сообщения.</li></ul></li></ul>
<p>Текст сообщения и категория кодируются с целью исключения символов разделителей (символ пробела).
</p>
<h3><span class="mw-headline" id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D1.81.D0.BE.D0.BE.D0.B1.D1.89.D0.B5.D0.BD.D0.B8.D1.8F"><span class="mw-headline-number">1.2</span> Пример файла архива сообщения</span></h3>
<p><b>Пример содержимого архивного файла в формате языка XML:</b>
</p>
<pre style="white-space: pre-wrap;">
&lt;?xml version='1.0' encoding='UTF-8'&nbsp;?&gt;
&lt;FSArch Version="1.3.0" Begin="4a27dfbc" End="4a28c990"&gt;
&lt;m tm="4a28c982" tmu="905587" lv="4" cat="/DemoStation/sub_DAQ/mod_DiamondBoards/"&gt;Ошибка dscInit.&lt;/m&gt;
&lt;m tm="4a28c990" tmu="595549" lv="4" cat="/DemoStation/sub_Transport/mod_Sockets/out_HDDTemp/"&gt;Ошибка подключения к Internet сокету: Операция выполняется в данный момент!&lt;/m&gt;
&lt;/FSArch&gt;
</pre>
<p><b>Пример содержимого архивного файла в формате плоского текста:</b>
</p>
<pre style="white-space: pre-wrap;">
FSArch 1.2.0    UTF-8 4a27dfbb 4a28c991
4a28c98f:432619 1 /DemoStation/ Запуск!
4a28c98f:432858 1 /DemoStation/sub_Transport/ Пуск%20подсистемы.
4a28c98f:455400 1 /DemoStation/sub_DAQ/mod_DAQGate/cntr_test/ Включение%20контроллера!
4a28c98f:457360 1 /DemoStation/sub_DAQ/mod_ModBus/cntr_testTCP/ Включение%20контроллера!
4a28c98f:460691 1 /DemoStation/sub_DAQ/mod_ModBus/cntr_testRTU/ Включение%20контроллера!
4a28c98f:464227 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_Anast1to2node/ Включение%20контроллера!
4a28c98f:680767 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM102cntr/ Включение%20контроллера!
4a28c98f:705683 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_Anast1to2node_cntr/ Включение%20контроллера!
4a28c98f:753659 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM101/ Включение%20контроллера!
4a28c98f:905073 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM102/ Включение%20контроллера!
4a28c990:81670 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM201/ Включение%20контроллера!
4a28c990:206208 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_КМ202/ Включение%20контроллера!
4a28c990:333471 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM301/ Включение%20контроллера!
4a28c990:457490 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM302/ Включение%20контроллера!
4a28c990:591702 1 /DemoStation/sub_DAQ/mod_System/cntr_AutoDA/ Включение%20контроллера!
4a28c990:595549 4 /DemoStation/sub_Transport/mod_Sockets/out_HDDTemp/ Ошибка%20подключения%20к%20Internet%20сокету:%20Операция%20выполняется%20в%20данный%20момент!
4a28c990:618617 1 /DemoStation/sub_DAQ/mod_SoundCard/cntr_test/ Включение%20контроллера!
4a28c990:621487 1 /DemoStation/sub_DAQ/mod_LogicLev/cntr_experiment/ Включение%20контроллера!
4a28c990:729323 1 /DemoStation/sub_DAQ/mod_JavaLikeCalc/cntr_testCalc/ Включение%20контроллера!
4a28c990:733434 1 /DemoStation/sub_DAQ/mod_Siemens/cntr_test/ Включение%20контроллера!
4a28c990:754368 1 /DemoStation/sub_DAQ/mod_DAQGate/cntr_test/ Включение%20контроллера!
4a28c990:786925 1 /DemoStation/sub_Archive/ Пуск%20подсистемы.
4a28c990:955967 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_Anast1to2node/ Запуск%20контроллера!
4a28c990:957251 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM102cntr/ Запуск%20контроллера!
4a28c990:957636 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_Anast1to2node_cntr/ Запуск%20контроллера!
4a28c990:958006 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM101/ Запуск%20контроллера!
4a28c990:958637 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM102/ Запуск%20контроллера!
4a28c990:959268 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM201/ Запуск%20контроллера!
4a28c990:959875 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_КМ202/ Запуск%20контроллера!
4a28c990:961261 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM301/ Запуск%20контроллера!
4a28c990:961919 1 /DemoStation/sub_DAQ/mod_BlockCalc/cntr_KM302/ Запуск%20контроллера!
4a28c990:963775 1 /DemoStation/sub_DAQ/mod_System/cntr_AutoDA/ Запуск%20контроллера!
4a28c990:966980 1 /DemoStation/sub_DAQ/mod_LogicLev/cntr_experiment/ Запуск%20контроллера!
4a28c991:26791 1 /DemoStation/sub_Archive/ Пуск%20подсистемы.
4a28c991:28489 1 /DemoStation/sub_UI/mod_VCAEngine/ Старт%20модуля.
</pre>
<h2><span class="mw-headline" id=".D0.90.D1.80.D1.85.D0.B8.D0.B2.D0.B0.D1.82.D0.BE.D1.80_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9"><span class="mw-headline-number">2</span> Архиватор значений</span></h2>
<p>Архивы значений формируются архиваторами значений индивидуально для каждого зарегистрированного архива. Архиваторов может быть множество с индивидуальными настройками, позволяющими разделить архивы по различным параметрам, например, по точности и глубине.
</p><p>Архив значений является независимым компонентом, который включает буфер, обрабатываемый архиваторами. Основным параметром архива значения является источник данных. В роли источника данных могут выступать атрибуты параметров подсистемы "Сбор данных", а также другие внешние источники данных (пассивный режим). Другими источниками данных могут быть: сетевые архиваторы удалённых OpenSCADA систем, среда программирования системы OpenSCADA и др. Не менее важными параметрами архива являются параметры его буфера. От параметров буфера зависит возможность работы архиваторов. <a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> Так, периодичность значений в буфере должна быть не больше периодичности самого быстрого архиватора, а размер буфера не менее двойного размера для самого медленного архиватора. В противном случае возможны потери данных.
</p><p>Общая схема архивирования значений наглядно изображена на рис. 3.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:621px;"><a class="image" href="http://oscada.org/wiki/File:Arch_val_sh_ru.png"><img class="thumbimage" height="391" src="../files/Arch_val_sh_ru.png" width="619" /></a>  <div class="thumbcaption">Рис.3. Общая схема процесса архивирования значений.</div></div></div></div>
<p>Файлы архивов именуются архиваторами, исходя из даты первого значения в архиве и идентификатора архива. Например, таким образом: "MemInfo_use 2006-06-17 17:32:56.val".
</p><p>Файлы архивов могут ограничиваться по времени. После превышения лимита создаётся новый файл. Максимальное количество файлов в директории архиватора также может ограничиваться. После превышения лимита на количество файлов старые файлы начнут удаляться!
</p><p>С целью экономии дискового пространства архиваторы поддерживают упаковку в дополнении к последовательной упаковке старых архивов упаковщиком gzip. Упаковка производится после продолжительного неиспользования архива. Для обеспечения возможности быстрого подключения больших архивов к другой системе можно включить использование информационных файлов для упакованных файлов, что предотвратит предварительную распаковку всех файлов на другой системе.
</p><p>Модулем предоставляются дополнительные параметры настройки процесса архивирования (рис.4).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:898px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_val_a_prm_ru.png"><img class="thumbimage" height="711" src="../files/FSArch_val_a_prm_ru.png" width="896" /></a>  <div class="thumbcaption">Рис.4. Дополнительные параметры настройки процесса архивирования значений.</div></div></div></div>
<p>В число этих параметров входят:
</p>
<ul><li> <i>Размер файла архива по времени, в часах</i> — Параметр устанавливается автоматически при смене периодичности значений архиватора и в целом пропорционален периодичности значений архиватора. </li></ul>
<dl><dd><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> Большие файлы архива будут дольше обрабатываться в виду продолжительной распаковки gzip-файлов и первичной индексации, при доступе к участкам архива глубоко в истории.</dd></dl>
<ul><li> <i>Максимальное количество файлов одного архива</i> — Ограничивает максимальное количество файлов на архив и совместно с размером отдельного файла определяет размер архива на диска. Полностью снять это ограничение можно установив параметр в ноль.</li>
<li> <i>Максимальный размер всех архивов, в мегабайтах</i> — Устанавливает ограничение на максимально занимаемый объём дискового пространства файлами всех архивов архиватора. Проверка осуществляется с периодичностью проверки архивов (далее), в результате которой, по превышению лимита, производится удаление самых старых файлов всех архивов. Полностью снять это ограничение можно установив параметр в ноль.</li>
<li> <i>Округление числовых значений (%)</i> — Устанавливает граничный процент различия значений параметров целого и вещественного типов при котором они считаются одинаковыми и помещаются в архив как одно значение, посредством последовательной упаковки. Позволяет хорошо упаковывать слабоменяющиеся, за пределами достоверности, параметры. Отключить данное свойство можно установив параметр в ноль.</li>
<li> <i>Таймаут упаковки файлов, в минутах</i> — Устанавливает промежуток времени по истечению которого, и в случае отсутствия обращений, файлы архивов будут упаковываться gzip архиватором. Установить в ноль для отключения упаковки gzip.</li>
<li> <i>Период проверки архивов, в минутах</i> — Устанавливает периодичность проверки архивов на предмет появления или удаления в директории файлов архивов, а также превышение лимитов и удаление старых файлов архивов.</li>
<li> <i>Использовать информационный файл для упакованных архивов</i> — Указывает на необходимость создания файла с информацией о запакованных gzip-архиватором файлах архива. При копировании файлов архива на другую станцию этот информационный файл позволяют ускорить процесс первого запуска целевой станции за счёт исключения необходимости распаковки gzip-архивов для целью получения информации.</li>
<li> <i>Проверить директорию архиватора сейчас</i> — Команда, которая позволяет запустить проверку архивов немедленно, например, после ручного изменения в директории архиватора.</li></ul>
<p>Для контроля за файлами архиватора Вы можете посмотреть во вкладке "Файлы" (рис. 5).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:1151px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_val_files_ru.png"><img class="thumbimage" height="717" src="../files/FSArch_val_files_ru.png" width="1149" /></a>  <div class="thumbcaption">Рис.5. Вкладка "Файлы" объекта архиватора значений.</div></div></div></div>
<h3><span class="mw-headline" id=".D0.A4.D0.BE.D1.80.D0.BC.D0.B0.D1.82_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B0.D1.80.D1.85.D0.B8.D0.B2.D0.B0_.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B9"><span class="mw-headline-number">2.1</span> Формат файлов архива значений</span></h3>
<p>Для реализации архивирования на файловую систему предъявлялись следующие требования:
</p>
<ul><li> быстрый (простой) доступ на добавление в архив и чтение из архива;</li>
<li> возможность изменения значений в существующем архиве (с целью заполнения дыр в дублированных системах);</li>
<li> цикличность (ограничение размера);</li>
<li> возможность сжатия методом упаковки последовательности одинаковых значений, сохраняющим возможность быстрого доступа (последовательная упаковка);</li>
<li> возможность упаковки устаревших данных стандартными архиваторами (gzip, bzip2 ...) с возможностью распаковки при обращении.</li></ul>
<p>В соответствии с вышеизложенными требованиями организовано архивирование методом множественности файлов (для каждого источника). Цикличность архива реализуется на уровне файлов, т.е. создается новый файл, а самый старый удаляется. Для быстрого сжатия используется метод притягивания к последнему одинаковому значению. Для этих целей в файле архива предусматривается битовая таблица упаковки размером один в один с количеством хранимых данных. Т.е. каждый бит соответствует одному значению в архиве. Значение бита указывает на наличие значения. Для потока одинаковых значений биты обнулены. В случае с архивом строк таблица является не битовой а байтовой и содержит длину соответствующего значения. В случае поступления потока одинаковых значений, длина будет нулевой и читаться будет первое одинаковое значение. Поскольку таблица байтовая, то архив сможет хранить строки длиной не более 255 символов. Таким образом, методики хранения можно разделить на методику данных фиксированного и нефиксированного размера. Общая структура файла архива приведена на рис.6.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:202px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_file_struct_ru.png"><img class="thumbimage" height="339" src="../files/FSArch_file_struct_ru.png" width="200" /></a>  <div class="thumbcaption">Рис.6. Общая структура файла архива значений.</div></div></div></div>
<p>При создании нового файла архива формируется: заголовок (структура заголовка в таблице 1), нулевая битовая таблица упаковки архива и первое недостоверное значение. Таким образом, получится архив, инициализированный недостоверными значениями. В дальнейшем новые значения будут вставляться в область значений с корректировкой индексной таблицы упаковки. Из этого следует, что пассивные архивы будут вырождаться в файлы размером в заголовок и битовую таблицу.
</p><p><b>Таблица 1.</b> Структура заголовка файла архива
</p>
<table class="wikitable">

<tr>
<th> Поле </th>
<th> Описание </th>
<th> Размер байт(бит)
</th></tr>
<tr>
<td>f_tp</td>
<td>Системное имя архива ("OpenSCADA Val Arch.")</td>
<td>20
</td></tr>
<tr>
<td>archive</td>
<td>Имя архива, которому принадлежит файл.</td>
<td>20
</td></tr>
<tr>
<td>beg</td>
<td>Время начала архивных данных (мкс)</td>
<td>8
</td></tr>
<tr>
<td>end</td>
<td>Время конца архивных данных (мкс)</td>
<td>8
</td></tr>
<tr>
<td>period</td>
<td>Периодичность архива (мкс)</td>
<td>8
</td></tr>
<tr>
<td>vtp</td>
<td>Тип значения в архиве (Логический, Целый, Вещественный, Строка)</td>
<td>(3)
</td></tr>
<tr>
<td>hgrid</td>
<td>Признак использования жёсткой сетки в буфере архива</td>
<td>(1)
</td></tr>
<tr>
<td>hres</td>
<td>Признак использования времени высокого разрешения (мкс) в буфере архива</td>
<td>(1)
</td></tr>
<tr>
<td>reserve</td>
<td>Резерв</td>
<td>14
</td></tr>
<tr>
<td>term</td>
<td>Символ окончания заголовка архива (0x55)</td>
<td>1
</td></tr></table>
<p>Разъяснение механизма последовательной упаковки приведено на рис. 7. Как можно видеть из рисунка признак упаковки содержит длину (нефиксированные типы) или признак упаковки (фиксированные типы) отдельно взятого значения. Это значит, что для получения смещения нужного значения необходимо сложить длины всех предыдущих действительных значений. Выполнение данной операции каждый раз и для каждого значения является крайне накладной операцией. Поэтому был внедрён механизм кеширования смещений значений. Механизм кеширует смещения значений через предопределённое их количество, а также кеширует смещение последнего значения к которому производился доступ (отдельно на чтение и запись).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:602px;"><a class="image" href="http://oscada.org/wiki/File:FSArch_file_mpack_ru.png"><img class="thumbimage" height="327" src="../files/FSArch_file_mpack_ru.png" width="600" /></a>  <div class="thumbcaption">Рис.7. Механизм последовательной упаковки значений.</div></div></div></div>
<p>Изменения значений внутри существующего архива также предусмотрено. Однако, учитывая необходимость выполнения сдвига хвоста архива, рекомендуется выполнять эту операцию как можно реже и как можно большими блоками.
</p>
<h2><span class="mw-headline" id=".D0.AD.D1.84.D1.84.D0.B5.D0.BA.D1.82.D0.B8.D0.B2.D0.BD.D0.BE.D1.81.D1.82.D1.8C"><span class="mw-headline-number">3</span> Эффективность</span></h2>
<p>При проектировании и реализации данного модуля были заложены механизмы повышения эффективности процесса архивирования.
</p><p>Первым механизмом является механизм блочного(покадрового или транзактивного) помещения данных в файлы архивов значений. Такой механизм позволяет достичь максимальной скорости архивирования, а следовательно и позволяет одновременно архивировать больше потоков данных. Опыт практического применение показал, что система K8-3000 с обычным IDE жестким диском способна архивировать до 300000 потоков данных с периодичностью 1 секунда или, система K5-400 с IDE диском (2.5") способна архивировать до 100 параметров с периодичностью 1 миллисекунда.
</p><p>Вторым механизмом является упаковка как текущих значений, так и устаревших файлов архивов для оптимизации используемого дискового пространства. Реализовано два механизма упаковки: механизм последовательной упаковки (архивы значений) и механизм дожатия архивов стандартным упаковщиком (gzip). Данный подход позволил достичь высокой производительности в процессе архивирования текущих данных с эффективным механизмом последовательного сжатия. А дожатие стандартным упаковщиком устаревших архивов завершает общую картину компактного хранения больших массивов данных. Статистика практического применения в условиях реального зашумленного сигнала(худшая ситуация) показала, что степень последовательной упаковки составила 10%, а степень полной упаковки составила 71%.
</p>





</div></body>
</html>