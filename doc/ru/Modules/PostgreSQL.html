<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html class="client-nojs" dir="ltr" lang="en">
<head>
<title>Модули/PostgreSQL - OpenSCADAWiki</title>
<meta content="MediaWiki 1.26.4" name="generator" />
<link href="https://www.gnu.org/copyleft/fdl.html" rel="copyright" />
<link href="../files/doc.css" rel="stylesheet" /></head>
<body><div id="mw_header">
			<div class="mw-indicators">
</div>
			<h1 id="firstHeading" lang="ru">Модули/PostgreSQL</h1>
		</div><div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="ru"><div class="mw-pt-translate-header noprint" dir="ltr" lang="en">This page is a <span class="plainlinks"><a class="external text" href="http://oscada.org/wiki/index.php?title=Special:Translate&amp;group=page-Modules%2FPostgreSQL&amp;action=page&amp;filter=&amp;language=ru" rel="nofollow noreferrer noopener" target="_blank">translated version</a></span> of the page <a class="external" href="http://oscada.org/wiki/Modules/PostgreSQL" title="Modules/PostgreSQL">Modules/PostgreSQL</a> and the translation is 100% complete.</div><hr /><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><div class="mw-pt-languages-list autonym"><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/PostgreSQL" title="Modules/PostgreSQL (100% translated)">English</a>&nbsp;• ‎<span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete">российский</span>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/PostgreSQL/uk" title="Модулі/PostgreSQL (100% translated)">українська</a></div></div>
<div class="noprint" style="float:right; border:1px solid gray; width:300px; background-color:ivory; padding:2px;">
<table cellspacing="0">
<tr>
<td> <a class="image" href="http://oscada.org/wiki/File:Constr.png"><img alt="Constr.png" height="32" src="../files/Constr.png" width="32" /></a>
</td>
<td style="padding-left:5px;"> The translation checking and actualizing
</td></tr></table>
</div>
<table class="wikitable">

<tr>
<th> Модуль </th>
<th> Имя </th>
<th> Версия </th>
<th> Лицензия </th>
<th> Источник </th>
<th> Языки </th>
<th> Платформы </th>
<th> Тип </th>
<th> Автор </th>
<th> Описание
</th></tr>

<tr>
<td> <a href="../Modules/PostgreSQL.html" title="Special:MyLanguage/Modules/PostgreSQL">PostgreSQL</a> </td>
<td> БД PostgreSQL </td>
<td> 1.8 </td>
<td> GPL2 </td>
<td> bd_PostgreSQL.so </td>
<td> en,uk,ru,de </td>
<td> x86,x86_64,ARM
</td>
<td> БД </td>
<td> Роман Савоченко, Максим Лысенко (2010-2011) </td>
<td> Модуль БД. Предоставляет поддержку БД PostgreSQL.
</td></tr></table>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D0.91.D0.94"><span class="tocnumber">1</span> <span class="toctext">Операции над БД</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D0.B5.D0.B9"><span class="tocnumber">2</span> <span class="toctext">Операции над таблицей</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#.D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D1.81.D0.BE.D0.B4.D0.B5.D1.80.D0.B6.D0.B8.D0.BC.D1.8B.D0.BC_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D1.8B"><span class="tocnumber">3</span> <span class="toctext">Операции над содержимым таблицы</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#.D0.94.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D0.BA_.D0.91.D0.94"><span class="tocnumber">4</span> <span class="toctext">Доступ к БД</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#.D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.B4.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D0.BE.D1.81.D1.82.D1.8C_.D0.A1.D0.A3.D0.91.D0.94"><span class="tocnumber">5</span> <span class="toctext">Производительность СУБД</span></a></li>
</ul>
</div>

<p>Модуль "PostgreSQL" предоставляет в OpenSCADA поддержку БД PostgreSQL. БД PostgreSQL является мощной реляционной и многоплатформенной БД, доступной по свободной лицензии. Разработчиком БД PostgreSQL является сообщество PostgreSQL  <a class="external free" href="http://www.postgresql.org/" rel="nofollow noreferrer noopener" target="_blank">http://www.postgresql.org/</a>. Модуль основан на библиотеке API производителя БД PostgreSQL на языке "С". Модуль позволяет выполнять действия над базами данных, таблицами и содержимым таблиц.
</p>
<h2><span class="mw-headline" id=".D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D0.91.D0.94"><span class="mw-headline-number">1</span> Операции над БД</span></h2>
<p>Поддерживаются операции открытия и закрытия БД с возможностью создания новой БД при открытии и удаления существующей при закрытии. В терминах подсистемы "БД" системы OpenSCADA открытием БД является её регистрация для последующего использования в системе. Также поддерживается операция запроса списка таблиц в БД.
</p><p>БД PostgreSQL адресуется строкой следующего типа: <b>{host};{hostaddr};{user};{pass};{db};{port}[;{connect_timeout}]</b>. Где:
</p>
<ul><li> <i>host</i> — Имя хоста для подключения. Если начинается с косой черты, оно указывает Unix-domain соединение вместо TCP/IP соединения, значение — это имя каталога, в котором хранится файл сокета.</li>
<li> <i>hostaddr</i> — числовой IP адрес хоста для подключения, на котором работает сервер БД PostgreSQL;</li>
<li> <i>user</i> — имя пользователя БД;</li>
<li> <i>pass</i> — пароль пользователя для доступа к БД;</li>
<li> <i>bd</i> — имя БД;</li>
<li> <i>port</i> — порт, который слушает сервер БД (по умолчанию 5432);</li>
<li> <i>connect_timeout</i> — таймаут соединения.</li></ul>
<p>В случае локального доступа к БД, в пределах одного хоста, строка адреса может выглядеть следующим образом: <b>;;roman;123456;OpenSCADA;;10</b>
</p><p>В случае удалённого доступа к БД нужно использовать адрес хоста и порт сервера БД. Например: <b>server.nm.org;;roman;123456;OpenSCADA;;10</b>
</p>
<h2><span class="mw-headline" id=".D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D0.B5.D0.B9"><span class="mw-headline-number">2</span> Операции над таблицей</span></h2>
<p>Поддерживаются операции открытия, закрытия таблицы с возможностью создания новой таблицы при открытии и удаления существующей при закрытии, а также запрос структуры таблицы.
</p>
<h2><span class="mw-headline" id=".D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.B8_.D0.BD.D0.B0.D0.B4_.D1.81.D0.BE.D0.B4.D0.B5.D1.80.D0.B6.D0.B8.D0.BC.D1.8B.D0.BC_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D1.8B"><span class="mw-headline-number">3</span> Операции над содержимым таблицы</span></h2>
<ul><li> сканирование записей таблицы;</li>
<li> запрос значений указанных записей;</li>
<li> установка значения указанных записей;</li>
<li> удаление записей.</li></ul>
<p>API подсистемы "БД" предполагает доступ к содержимому таблицы по значению ключевого(ых) поля(ей). Так, операция запроса записи подразумевает предварительную установку ключевых колонок объекта TConfig, по которым будет выполнен запрос. Создание новой записи(строки) производится операцией установки значений записи, которая отсутствует.
</p><p>Модуль позволяет динамически изменять структуру таблиц БД PostgreSQL. Так, в случае несоответствия структуры таблицы и структуры устанавливаемой записи, структура таблицы будет приведена к требуемой структуре записи. В случае запроса значений записи и несоответствия структур записи и таблицы, будут получены только значения общих элементов записи и таблицы. Модуль не отслеживает порядок расположения элементов в записи и структуре таблицы.
</p><p>Модулем реализуется механизм поддержки многоязыковых текстовых переменных. Для полей с многоязыковой текстовой переменной создаются колонки отдельных языков в формате <b>{lang}#{FldID}</b> (en#NAME). При этом базовая колонка содержит значение для базового языка. Колонки отдельных языков создаются по надобности, в момент сохранения в БД и при исполнении OpenSCADA в соответствующей локали. В случае отсутствия значения для конкретного языка будет использоваться значения для базового языка.
</p><p>Типы элементов БД PostgreSQL следующим образом соответствуют типам элементов системы OpenSCADA:
</p>
<table class="wikitable">

<tr>
<th> Типы полей системы OpenSCADA </th>
<th> Типы полей БД PostgreSQL
</th></tr>
<tr>
<td>TFld::String </td>
<td> character(n), character varying(n),  text
</td></tr>
<tr>
<td>TFld::Integer </td>
<td> integer, bigint, timestamp with time zone [для полей с флагом TFld::DateTimeDec]
</td></tr>
<tr>
<td>TFld::Real </td>
<td> double precision
</td></tr>
<tr>
<td>TFld::Boolean </td>
<td> smallint
</td></tr></table>
<h2><span class="mw-headline" id=".D0.94.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D0.BA_.D0.91.D0.94"><span class="mw-headline-number">4</span> Доступ к БД</span></h2>
<p>БД PostgreSQL содержит механизм разделения доступа, который заключается в указании привилегий пользователя БД. В таблице ниже перечислены необходимые привилегии для полноценной работы.
</p>
<table class="wikitable">

<tr>
<th> Операция </th>
<th> Привилегия
</th></tr>
<tr>
<td>Создание БД</td>
<td>CREATEDB
</td></tr>
<tr>
<td>Создание соединения</td>
<td>LOGIN
</td></tr></table>
<p>Для доступа к БД права нужно разрешать непосредственно для указанной БД, а в случае создания БД нужно также разрешать доступ к системной БД "template1", используемой для подключения на стадии создания новой БД.
</p><p>Кратко рассмотрим процедуру первичной настройки сервера PostgreSQL, с целью подключения к нему с помощью данного модуля:
</p>
<ul>
<li>Установка сервера СУБД PostgreSQL в виде пакета или сборкой.</li>
<li>Первичная инициализация сервера:
<pre style="white-space: pre-wrap;">
# Инициализация БД
$ service postgresql initdb
# Запуск БД
$ service postgresql start
</pre></li>
<li>Разрешаем доверенный доступ из локальной или нужной подсети, отредактировав файл /var/lib/pgsql/data/pg_hba.conf на предмет установки "trust":
<pre style="white-space: pre-wrap;">
local   all             all                                     trust
host    all             all             127.0.0.1/32            trust
</pre></li>
<li>Перезапускаем сервер после редактирования доступа:
<pre style="white-space: pre-wrap;">
$ service postgresql restart</pre></li>
<li>Устанавливаем нужный пароль для системного пользователя "postgres":
<pre style="white-space: pre-wrap;">
$ psql -U postgres -d template1 -c "ALTER USER postgres PASSWORD '123456'"</pre></li>
<li>Подключаемся к серверу БД с помощью данного модуля, введя адрес БД: <b>"localhost;;postgres;123456;test"</b></li>
</ul>
<h2><span class="mw-headline" id=".D0.9F.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.B4.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D0.BE.D1.81.D1.82.D1.8C_.D0.A1.D0.A3.D0.91.D0.94"><span class="mw-headline-number">5</span> Производительность СУБД</span></h2>
<p>Замер производительности БД выполнялся тестом "БД" модуля системных тестов "SystemTests" путём выполнения операций над записями структурой: "<b>name char (20), descr char (50), val double (10.2), id int (7), stat bool, reqKey string, reqVal string</b>". OpenSCADA запускалась с демонстрационной конфигурацией.
</p>
<table class="wikitable">

<tr>
<th> Operation </th>
<th> Nokia N800, PostgreSQL 8.3 (remote) </th>
<th> AMD Turion L625 1.6, 2G, PostgreSQL 9.1 [local; 100Base-TX] </th>
<th> Intel(R) Core(TM) i3 CPU 1.33GHz, 3G, HDD [100Base-TX]
</th></tr>
<tr>
<td> <i>Creation of the 1000 records (sec.):</i> </td>
<td> 5 </td>
<td> 1.08; 1.6; 3.8 </td>
<td> 2.07
</td></tr>
<tr>
<td> <i>Updating of the 1000 records (sec.):</i> </td>
<td> 4.8 </td>
<td> 1.12; 1.6; 3.9 </td>
<td> 2.35
</td></tr>
<tr>
<td> <i>Getting of the 1000 records (sec.):</i> </td>
<td> 2.96 </td>
<td> 0.64; 1.2; 2.1 </td>
<td> 1.26
</td></tr>
<tr>
<td> <i>Seeking of the 1000 records (sec.):</i> </td>
<td> - </td>
<td> - </td>
<td> <span style="color: red">7.9</span>
</td></tr>
<tr>
<td> <i>Seeking in preload of the 1000 records (sec.):</i> </td>
<td> - </td>
<td> - </td>
<td> 0.038
</td></tr>
<tr>
<td> <i>Deleting of the 1000 record (sec.):</i> </td>
<td> 1.73 </td>
<td> 0.39; 0.6; 1.6 </td>
<td> 0.94
</td></tr></table>






</div></body>
</html>