<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="UTF-8" />
<title>Модулі/Siemens - OpenSCADAWiki</title>
<meta content="MediaWiki 1.26.4" name="generator" />
<link href="https://www.gnu.org/copyleft/fdl.html" rel="copyright" />
<link href="../../en/files/doc.css" rel="stylesheet" /></head>
<body><div class="floatright"><a href="http://oscada.org"><img alt="OpenSCADA" src="../../en/files/Logo-big.png" /></a></div><div id="mw_header">
			<div class="mw-indicators">
</div>
			<h1 id="firstHeading" lang="uk">Модулі/Siemens</h1>
		</div><div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="uk"><div class="mw-pt-translate-header noprint" dir="ltr" lang="en">This page is a <span class="plainlinks"><a class="external text" href="http://oscada.org/wiki/index.php?title=Special:Translate&amp;group=page-Modules%2FSiemens&amp;action=page&amp;filter=&amp;language=uk" rel="nofollow noreferrer noopener" target="_blank">translated version</a></span> of the page <a class="external" href="http://oscada.org/wiki/Modules/Siemens" title="Modules/Siemens">Modules/Siemens</a> and the translation is 100% complete.</div><hr /><div class="mw-pt-languages" dir="ltr" lang="en"><div class="mw-pt-languages-list autonym"><a class="mw-pt-languages-ui mw-pt-progress mw-pt-progress--complete" href="../../en/Modules/Siemens.html" title="Modules/Siemens (100% translated)">English</a>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="../../ru/Modules/Siemens.html" title="Модули/Siemens (100% translated)">российский</a>&nbsp;• ‎<span class="mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete">українська</span></div></div>
<table class="wikitable">

<tr>
<th> Модуль </th>
<th> Ім'я </th>
<th> Версія </th>
<th> Ліцензія </th>
<th> Джерело </th>
<th> Мови </th>
<th> Платформи </th>
<th> Тип </th>
<th> Автор
</th></tr>

<tr>
<td> <a href="../Modules/Siemens.html" title="Special:MyLanguage/Modules/Siemens">Siemens</a> </td>
<td> Збір даних Siemens та Beckhoff
</td>
<td> 4.3 </td>
<td> GPL2 </td>
<td> daq_Siemens.so </td>
<td> en,uk,ru,de </td>
<td> x86,x86_64,ARM
</td>
<td> DAQ </td>
<td> Роман Савоченко
</td></tr>
<tr>
<th colspan="9"> Опис
</th></tr>
<tr>
<td colspan="9"> Забезпечує підтримку джерел даних ПЛК Siemens за допомогою карт HILSCHER CIF (протоколом MPI) та бібліотеки LibnoDave (або власної реалізації) для решти. Також підтримуються джерела даних фірми Beckhoff для протоколу TwinCAT ADS/AMS, оскільки він також працює з блоками даних.
<ul><li> <b>Спонсорування, підтримки Простого типу та визначення областей даних на 1.5 <span title="людино-днів, 1ЛД — 10 годин">ЛД<sup style="color: blue">[!]</sup></span>:</b> INSERTEC LTDA</li>
<li> <b>Зробити (To Do):</b></li></ul>
<dl><dd> + доповнити вбудованим Стандартним Режимом DAQ-Параметрів.</dd></dl>
</td></tr></table>
<p>Першочерговою метою створення цього модуля становило забезпечення підтримки промислових контролерів фірми Siemens серії S7 (S7-200,300,400,1200). Історично склалося, що доступ до контролерів вказаної фірми у мережі ProfiBus здійснюється тільки за посередництвом власних комунікаційних процесорів (CP5412, CP5613 та інше) та власного протоколу S7. Вказані комунікаційні процесори та API до протоколу S7 достатньо дорогі, крім того, драйвери до комунікаційних процесорів та S7 API закриті, а також доступні тільки для платформи Intel + MS Windows (зустрічалась деяка інформація про можливість придбати для Linux).
</p><p>У якості альтернативи комунікаційним процесорам від фірми Siemens, які дозволяють повноцінно працювати із контролерами фірми Siemens, виступає спектр комунікаційних продуктів фірми <a class="external text" href="http://hilscher.com" rel="nofollow noreferrer noopener" target="_blank">Hilscher</a> у особі комунікаційних процесорів CIF серії ProfiBus (PB) та бібліотека <a class="external text" href="http://libnodave.sourceforge.net" rel="nofollow noreferrer noopener" target="_blank">LibnoDave</a>.
</p><p>Особливістю продуктів Hilscher є повністю відкрита специфікація протоколу обміну із комунікаційним процесором, уніфікований драйвер для всіх плат CIF, наявність драйверу для багатьох розповсюджених операційних систем (ОС) та відкритість драйверу для ОС Linux (GPL).
</p><p>У основу даного модуля покладено драйвер версії 2.621 фірми Hilsher, люб'язно наданого фірмою Hilsher в особі <a class="external text" href="mailto:DTsaava@hilscher.com" rel="nofollow noreferrer noopener" target="_blank">Devid Tsaava</a> для ядер серії 2.6 ОС Linux. Всі потрібні для збірки файли включено до модуля та він не потребує задоволення спеціальних залежностей. Драйвер версії 2.621 для плат CIF можна завантажити <a class="external" href="http://oscada.org/wiki/File:Siemens_cif2621.tgz" title="File:Siemens cif2621.tgz">тут</a>.
</p><p>Плати фірми Hilsher родини CIF та уніфікований драйвер підтримують широкий спектр обладнання. Закласти підтримку всіх цих можливостей у цьому модулі, не маючи всього цього обладнання на руках, не є можливим. Тому підтримка того або іншого обладнання буде додаватися за потреби та наявності обладнання. За станом на версію 2.0.0 модулем надається підтримка джерел даних у мережі ProfiBus або MPI, за посередництвом протоколу MPI, на швидкостях мережі від 9600Бод до 12МБод. Зокрема підтримуються та виконано перевірку на контролерах фірми Siemens родини S7 (S7-200,300,400).
</p><p>Бібліотека LibnoDave є реалізацією, шляхом реверсінженірингу, протоколів MPI, S7, ISO-TSAP та інших, які використовуються при взаємодії із контролерами фірми Siemens. Бібліотекою підтримуються багато MPI та USB адаптерів, а також ProfiNet. Комунікаційні процесори фірми Siemens, на платформах відмінних від MS Windows, бібліотекою не підтримуються. За посередництвом бібліотеки LibnoDave, на цьому етапі, модулем забезпечено підтримку протоколу ISO-TSAP(ProfiNet). Бібліотеку LibnoDave повністю включено в цей модуль та вона не потребує вирішення залежностей як при збірці, так і при виконанні.
</p><p><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../../en/files/At.png" width="22" /></a> У коді бібліотеки LibnoDave присутні складно-вловимі помилки, які переважно відтворюються під великим навантаженням та в момент підключень, що призводить до псування пам'яті процесу та <a class="external" href="http://oscada.org/wiki/File:Siemens_crash_20160127_0911.crash.gz" title="File:Siemens crash 20160127 0911.crash.gz">падіння</a> у непередбачених місцях. У зв'язку з цим, з версії 2 цього модуля, розпочато процес переписування потрібних функцій та код зв'язку ISO-TCP вже готовий до використання.
</p><p>Також, модулем реалізуються функції горизонтального резервування, а саме — спільної роботи із віддаленою станцією цього-ж рівня. Крім синхронізації значень та архівів атрибутів параметрів, модулем здійснюється синхронізація значень обчислювальних шаблонів з метою безударного підхоплення алгоритмів.
</p>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.D0.9A.D0.BE.D0.BC.D1.83.D0.BD.D1.96.D0.BA.D0.B0.D1.86.D1.96.D0.B9.D0.BD.D1.96_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D0.B5.D1.80.D0.B8_CIF"><span class="tocnumber">1</span> <span class="toctext">Комунікаційні контролери CIF</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.D0.9E.D0.B1.27.D1.94.D0.BA.D1.82_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D0.B5.D1.80.D1.83"><span class="tocnumber">2</span> <span class="toctext">Об'єкт контролеру</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#.D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.B8"><span class="tocnumber">3</span> <span class="toctext"><span>Параметри</span></span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#.D0.9B.D0.BE.D0.B3.D1.96.D1.87.D0.BD.D0.B8.D0.B9_.28logic.29"><span class="tocnumber">3.1</span> <span class="toctext">Логічний (logic)</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.B8.D0.B9_.28std.29"><span class="tocnumber">3.2</span> <span class="toctext">Простий (std)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#.D0.90.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D0.B8.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC_.D0.B7.D0.B0.D0.BF.D0.B8.D1.81.D1.83"><span class="tocnumber">4</span> <span class="toctext">Асинхронний режим запису</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#API_.D0.BA.D0.BE.D1.80.D0.B8.D1.81.D1.82.D1.83.D0.B2.D0.B0.D1.86.D1.8C.D0.BA.D0.BE.D0.B3.D0.BE_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D1.83.D0.B2.D0.B0.D0.BD.D0.BD.D1.8F"><span class="tocnumber">4.1</span> <span class="toctext"><span>API користувацького програмування</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#.D0.94.D0.BE.D0.B4.D0.B0.D1.82.D0.BE.D0.BA_A._.D0.9E.D0.B1.D0.BB.D0.B0.D1.81.D1.82.D1.96_.D0.94.D0.B0.D0.BD.D0.B8.D1.85_.D0.BF.D1.96.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D1.8C_ISO_TCP_.28.D0.B2.D0.B8.D1.85.D1.96.D0.B4.D0.BD.D0.B0_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D1.8F_LibnoDave.29"><span class="tocnumber">5</span> <span class="toctext"><span>Додаток A. Області Даних підключень ISO_TCP</span> (вихідна таблиця LibnoDave)</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#.D0.97.D0.B0.D1.83.D0.B2.D0.B0.D0.B6.D0.B5.D0.BD.D0.BD.D1.8F"><span class="tocnumber">6</span> <span class="toctext"><span>Зауваження</span></span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#.D0.9F.D0.BE.D1.81.D0.B8.D0.BB.D0.B0.D0.BD.D0.BD.D1.8F"><span class="tocnumber">7</span> <span class="toctext">Посилання</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id=".D0.9A.D0.BE.D0.BC.D1.83.D0.BD.D1.96.D0.BA.D0.B0.D1.86.D1.96.D0.B9.D0.BD.D1.96_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D0.B5.D1.80.D0.B8_CIF"><span class="mw-headline-number">1</span> Комунікаційні контролери CIF</span></h2>
<p>Драйвером плат сімейства CIF підтримується можливість встановлення до 4 CIF плат. З метою контролю за наявністю плат у системі та можливості їх конфігурації, модуль містить форму контролю та конфігурації CIF-плат (рис.1).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:786px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_cif_dev.png"><img class="thumbimage" height="567" src="../../en/files/Siemens_cif_dev.png" width="784" /></a>  <div class="thumbcaption">Рис.1. Вкладка конфігурації CIF-плат.</div></div></div></div>
<p>За допомогою цієї форми можна проконтролювати наявність комунікаційних процесорів, їх конфігурацію, а також налаштувати параметри мережі ProfiBus у вигляді PB адреси комунікаційного процесору та швидкості шини ProfiBus. У другій вкладці модуля (рис.2) можна проконтролювати наявність різних станцій в мережі ProfiBus.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:634px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_pb.png"><img class="thumbimage" height="559" src="../../en/files/Siemens_pb.png" width="632" /></a>  <div class="thumbcaption">Рис.2. Вкладка моніторингу мережі ProfiBus.</div></div></div></div>
<h2><span class="mw-headline" id=".D0.9E.D0.B1.27.D1.94.D0.BA.D1.82_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D0.B5.D1.80.D1.83"><span class="mw-headline-number">2</span> Об'єкт контролеру</span></h2>
<p>Для додання джерела даних створюється та конфігурується об'єкт контролеру OpenSCADA. Приклад вкладки конфігурації объекту контролеру даного типу наведено на рисунку 3.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:831px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_cntr_uk.png"><img class="thumbimage" height="717" src="../files/Siemens_cntr_uk.png" width="829" /></a>  <div class="thumbcaption">Рис.3. Вкладка конфігурації об'єкту контролеру.</div></div></div></div>
<p>За допомогою цієї вкладки можна встановити:
</p>
<ul><li> Стан об'єкту контролеру, а саме: Статус, "Ввімкнено", "Виконується" та ім'я БД, яка містить конфігурацію.</li></ul>
<dl><dd><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../../en/files/At.png" width="22" /></a> Ручний перезапуск ввімкненого об'єкту контролеру викликає примусове переформування блоків збору.</dd></dl>
<ul><li> Ідентифікатор, ім'я та опис контролеру.</li>
<li> Стан "Ввімкнено" та "Виконується", у який переводити об'єкт контролеру при завантажені.</li>
<li> Ім'я таблиць зберігання конфігурації параметрів контролеру стандартного та логічного типу.</li>
<li> Політика планування та пріоритет задачі збору даних.</li>
<li> Час відновлення підключення, у секундах, після втрати зв'язку.</li>
<li> Режим асинхронного запису до віддаленого контролеру.</li>
<li> Тип з'єднання, підтримуються:
<ul><li> <i>CIF_PB</i> — підключення до контролерів серії S7 фірми Siemens за посередництвом комунікаційного процесору CIF-50PB або схожого;</li>
<li> <i>ISO_TCP</i>, <i>ISO_TCP243</i> — підключення до контролерів серії S7 фірми Siemens за посередництвом мережі Ethernet (TCP243 для CP243);</li>
<li> <i>ADS</i> — TwinCAT ADS/AMS протокол для підключення до контролерів фірми Beckhoff.</li></ul></li>
<li> Адреса віддаленого контролеру, для підключень:
<ul><li> <i>CIF_PB</i> — адреса контролеру у мережі ProfiBus, цифра 0-255;</li>
<li> <i>ISO_TCP</i>, <i>ISO_TCP243</i> — IP-адреса контролеру у мережі Ethernet;</li>
<li> <i>ADS</i> — мережевий ідентифікатор та порт цільового контролеру та вихідної станції, у вигляді <b>{Target_AMSNetId}:{Target_AMSPort}|{Source_AMSNetId}:{Source_AMSPort}</b> (наприклад: "192.168.0.1.1.1:801|82.207.88.73.1.1:801"), де:
<ul><li> <i>AMSNetId</i> — мережевий ідентифікатор, записується у вигляді шести цифр 0-255, наприклад: "192.168.0.1.1.1";</li>
<li> <i>AMSPort</i> — порт, записується у вигляді числа 0-65535.</li></ul></li></ul></li>
<li> Слот ЦП ПЛК у який встановлено центральний процесор контролеру.</li>
<li> CIF плата, використана для доступу до промислового контролеру за посередництвом CIF комунікаційних процесорів.</li>
<li> <a href="../Program_manual.html#Transports" title="Special:MyLanguage/Documents/Program manual">Вихідний транспорт OpenSCADA</a> для протоколу ADS (порт 48898, 801 для AMS) та ISO_TCP (порт 102) для надсилання запитів.</li></ul>
<h2><span class="mw-headline" id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80.D0.B8"><span class="mw-headline-number">3</span> <span id="Parameters" title="#Parameters">Параметри</span></span></h2>
<p>Модуль збору даних надає два типи параметру: "Логічний (logic)" та "Простий (simple)". Додатковими конфігураційними полями параметрів цього модуля є:
</p>
<ul><li> <i><b>Логічний (logic)</b></i>:
<ul><li> <i>Шаблон параметру</i> — адреса шаблону параметру DAQ.</li></ul></li>
<li> <i><b>Простий (simple)</b></i>:
<ul><li> <i>Перелік атрибутів</i> — містить структурований перелік конфігурації атрибутів Siemens.</li></ul></li></ul>
<h4><span class="mw-headline" id=".D0.9B.D0.BE.D0.B3.D1.96.D1.87.D0.BD.D0.B8.D0.B9_.28logic.29"><span class="mw-headline-number">3.1</span> Логічний (logic)</span></h4>
<p>Враховуючи високу інтелектуальність джерел даних, в особі промислових контролерів фірми Siemens S7-200,300,400,1200, об'єкти типу параметру виконуються на основі <a href="../DAQ.html#LogicLev" title="Special:MyLanguage/Documents/DAQ">шаблонів</a>. Такий підхід дозволяє не обмежуватися жорстким переліком типів параметрів, що обмежує й можливості контролерів, а надати можливість користувачу формувати потрібні йому типи параметрів самостійно або використовувати бібліотеки вже розроблених раніш типів параметрів — шаблонів.
</p><p>Додатковими конфігураційними полями типу параметрів (рис.4) є поле вибору шаблону параметра.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:781px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_prm_uk.png"><img class="thumbimage" height="545" src="../files/Siemens_prm_uk.png" width="779" /></a>  <div class="thumbcaption">Рис.4. Вкладка конфігурації параметру.</div></div></div></div>
<p>Для конфігурації шаблону параметра надається відповідна вкладка, вміст якої визначається конфігурацією шаблона, тобто формуються відповідні поля посилань та встановлення постійних.
</p><p>Кінцева адреса Siemens-БД записується у формі "<b>(DB{N}|F).{off}[.[{tp}]{SzBit}]</b>", де:
</p>
<ul><li> <b>DB</b>{<i>N</i>} — десятковий номер Блоку Даних, може бути негативним для специфічних областей даних типів підключення ISO_TCP (дивіться <a href="#DataAreas">Додаток A</a> щодо областей даних);</li>
<li> <b>F</b> — специфічна область даних Прапорців/Маркерів (131) типів підключення ISO_TCP;</li>
<li> <i>off</i> — зсув у Блоку Даних;</li>
<li> <i>tp</i> — тип одним символом з переліку: b-Логічний, i-Знакове ціле, u-Беззнакове ціле, r-Реальне, s-Рядок;</li>
<li> <i>SzBit</i> — розмір типу для не Логічного або біт байту для нього: b=[0...7], iu=[1,2(тип.),4,8], r=[4(тип.),8], s=[0(тип.10)...100].</li></ul>
<p>Приклади кінцевих адрес:
</p>
<ul><li> "DB1.12.2", "DB1.0xC.2", "DB1.12.b2" — Логічний у БД 1, зсув 12 та біт 2;</li>
<li> "DB2.24", "DB2.0x18.8" — Ціле або Реальне, отримане з типу ВВ шаблону, у БД 2, зсув 24, розмір типовий та 8;</li>
<li> "DB3.36.i4", "DB3.0x24.r8" — прямо визначене Ціле та Реальне у БД 3, зсув 36, розмір 4 та 8;</li>
<li> "DB4.48.20", "DB4.0x30.s20" — неявно, з типу ВВ шаблону, та прямо визначений Рядок у БД 4, зсув 48 та розмір 20;</li>
<li> "F.12.5" — Логічне у області даних Прапорці/Маркери, зміщення 12 та біт 5.</li></ul>
<p>Типи посилань за звичай визначаються типом параметру у шаблоні (Логічний, Цілий, Реальний та Строковий) та визначенням значення посилання (для групових посилань). Визначення групового посилання у шаблоні записується у форматі "<b>{LnkName}|{OffDB}[.{bit}][|[{tp}]{sz}]</b>", де:
</p>
<ul><li> <i>LnkName</i> — назва групового посилання. Всі посилання із однаковою назвою групуються та вказуються як одне посилання на блок даних або блок даних з вказаним зсувом.</li>
<li> <i>OffDB</i> — номер зсуву у блоці даних. При зазначені у конфігурації шаблону лише блоку даних цей зсув буде вказано для параметру. Якщо-ж при конфігурації шаблону буде вказано і зсув, то обидва зсуви будуть сумуватися разом. Такий підхід дозволяє звертатися до декількох структур у одному блоці даних. Номер блоку даних та зсув можна вказувати у десятковому (3245) та шістнадцятковому форматі (0xCAD).</li>
<li> <i>bit</i> — номер біта для Логічного, [0...7].</li>
<li> <i>tp</i> — тип одним символом з переліку: i-Знакове ціле, u-Беззнакове ціле, r-Реальне, s-Рядок;</li>
<li> <i>sz</i> — розмір типу: iu=[1,2(тип.),4,8], r=[4(тип.),8], s=[0(тип.10)...100].</li></ul>
<p>Приклади типів зв'язку:
</p>
<ul><li> "Grp 1|0.0" — Логічний у "Grp 1", зсув 0 та біт 0;</li>
<li> "Grp 2|10|1", "Grp 2|0xA|i1" — Ціле, з типу ВВ шаблону та прямо, у "Grp 2", зсув 10 та розмір 1;</li>
<li> "Grp 3|20|20", "Grp 3|0x13|s20" — Рядок, з типу ВВ шаблону та прямо, у "Grp 3", зсув 20 та розмір 20.</li></ul>
<p>Наочний приклад загального процесу конфігурації параметру від шаблону й до значень приведено на рисунках від 5 до 8.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:886px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_tmpl_uk.png"><img class="thumbimage" height="638" src="../files/Siemens_tmpl_uk.png" width="884" /></a>  <div class="thumbcaption">Рис.5. Приклад шаблону із групуванням.</div></div></div></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:756px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_prm_tmpl_uk.png"><img class="thumbimage" height="512" src="../files/Siemens_prm_tmpl_uk.png" width="754" /></a>  <div class="thumbcaption">Рис.6. Вкладка конфігурації шаблону параметру.</div></div></div></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:756px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_prm_tmpl_off_uk.png"><img class="thumbimage" height="512" src="../files/Siemens_prm_tmpl_off_uk.png" width="754" /></a>  <div class="thumbcaption">Рис.7. Вкладка конфігурації шаблону параметра із визначенням параметрів окремо.</div></div></div></div>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:756px;"><a class="image" href="http://oscada.org/wiki/File:Siemens_prm_val_uk.png"><img class="thumbimage" height="547" src="../files/Siemens_prm_val_uk.png" width="754" /></a>  <div class="thumbcaption">Рис.8. Значення параметру.</div></div></div></div>
<p><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../../en/files/At.png" width="22" /></a> Модулем підтримується адресація тільки до блоків даних (БД) контролерів.
</p><p>Модулем передбачено особливу обробку низки атрибутів шаблону:
</p>
<ul><li> <i>f_frq</i> — частота обчислення процедури шаблону, тільки читання.</li>
<li> <i>f_start</i> — прапорець першого виконання процедури шаблону — запуск, тільки читання.</li>
<li> <i>f_stop</i> — прапорець останнього виконання процедури шаблону — зупинка, тільки читання.</li>
<li> <i>f_err</i> — помилка параметру, повний доступ. Значення цього атрибуту шаблону потрапляє до атрибуту помилки параметру — "err".</li>
<li> <i>SHIFR</i> — значення шифру параметра, тільки читання.</li>
<li> <i>NAME</i> — значення ім'я параметру, тільки читання.</li>
<li> <i>DESCR</i> — значення опису параметру, тільки читання.</li>
<li> <i>this</i> — об'єкт даного параметру, дозволяє отримати доступ до атрибутів параметру, наприклад, для доступу до архівів.</li></ul>
<h4><span class="mw-headline" id=".D0.9F.D1.80.D0.BE.D1.81.D1.82.D0.B8.D0.B9_.28std.29"><span class="mw-headline-number">3.2</span> Простий (std)</span></h4>
<p>Головну сторінку конфігурації параметру простого типу представлено на рисунку 9.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:684px;"><a class="image" href="http://oscada.org/wiki/File:SiemensSimpl_prm_uk.png"><img class="thumbimage" height="668" src="../files/SiemensSimpl_prm_uk.png" width="682" /></a>  <div class="thumbcaption">Рис.9. Вкладка конфігурації параметру простого типу.</div></div></div></div>
<p>Лінія атрибуту у параметрі переліку атрибутів записується наступним чином "<b>(DB{N}|F).{off}.{tp}{SzBit}:{flg}:{id}[:{name}]</b>".<br />
Де:
</p>
<ul><li> <b>DB</b>{<i>N</i>} — десятковий номер Блоку Даних, може бути негативним для специфічних областей даних типів підключення ISO_TCP (дивіться <a href="#DataAreas">Додаток A</a> щодо областей даних);</li>
<li> <b>F</b> — специфічна область даних Прапорців/Маркерів (131) типів підключення ISO_TCP;</li>
<li> <i>off</i> — зсув у Блоку Даних;</li>
<li> <i>tp</i> — тип одним символом з переліку: b-Логічний, i-Знакове ціле, u-Беззнакове ціле, r-Реальне, s-Рядок;</li>
<li> <i>SzBit</i> — розмір типу для не Логічного або біт байту для нього: b=[0...7], iu=[1,2(тип.),4,8], r=[4(тип.),8], s=[0(тип.10)...100];</li>
<li> <i>flg</i> — прапорці: режим запису/читання (r-читати, w-писати);</li>
<li> <i>id</i> — ідентифікатор атрибуту що створюється;</li>
<li> <i>name</i> — ім'я атрибуту що створюється.</li></ul>
<p>Приклади кінцевих адрес:
</p>
<ul><li> "DB1.12.b2:r:var:Variable" — Логічний у БД 1, зсув 12 та біт 2;</li>
<li> "DB2.24.u:rw:var:Variable", "DB2.0x18.r8:w:var" — Ціле або Реальне у БД 2, зсув 24, розмір типовий та 8;</li>
<li> "DB4.0x30.s20:r:var:Variable" — Рядок у БД 4, зсув 48 та розмір 20;</li>
<li> "F12.b5:r:var:Variable" — Логічне у області даних Прапорці/Маркери, зміщення 12 та біт 5.</li></ul>
<p>Лінія, що починається з символу '#', вважається коментарем та не обробляється.
</p><p>Відповідно до визначеного переліку атрибутів здійснюється опитування та створення атрибутів параметру (рис.10).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:684px;"><a class="image" href="http://oscada.org/wiki/File:SiemensSimpl_prm_atr_uk.png"><img class="thumbimage" height="566" src="../files/SiemensSimpl_prm_atr_uk.png" width="682" /></a>  <div class="thumbcaption">Рис.10. Вкладка атрибутів параметру простого типу.</div></div></div></div>
<h2><span class="mw-headline" id=".D0.90.D1.81.D0.B8.D0.BD.D1.85.D1.80.D0.BE.D0.BD.D0.BD.D0.B8.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC_.D0.B7.D0.B0.D0.BF.D0.B8.D1.81.D1.83"><span class="mw-headline-number">4</span> Асинхронний режим запису</span></h2>
<p>Стандартним режимом запису для SCADA-систем, які взаємодіють із PLC, є синхронний, оскільки він дозволяє контролювати коректність завершення операції запису. Однак, у випадку запису множини параметрів одразу, такий підхід не виправданий у зв'язку із надсиланням безлічі мілких запитів у контролер, що його перевантажує та займає тривалий проміжок часу. Вирішенням цієї проблеми є асинхронний запис суміжних значень одним блоком. Такий режим підтримується цим модулем та дозволяє записувати всі параметри одразу суміжними блоками по 240 байт. Читання та запис у такому режимі здійснюється суміжними блоками із періодичністю опитування контролеру.
</p>
<h3><span class="mw-headline" id="API_.D0.BA.D0.BE.D1.80.D0.B8.D1.81.D1.82.D1.83.D0.B2.D0.B0.D1.86.D1.8C.D0.BA.D0.BE.D0.B3.D0.BE_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D1.83.D0.B2.D0.B0.D0.BD.D0.BD.D1.8F"><span class="mw-headline-number">4.1</span> <span id="UserAPI" title="#UserAPI">API користувацького програмування</span></span></h3>
<p>У зв'язку із підтримкою параметрів логічного типу, має сенс надання низки функцій користувацького API для їх виклику із шаблону логічного параметру.
</p><p><b>Об'єкт "Параметр" [this]</b>
</p>
<ul><li> <i>bool attrAdd( string id, string name, string tp = "real", string selValsNms = "" )</i> [<span style="color: red">для включеного параметру логічного типу</span>] — додання атрибуту <i>id</i> з ім'ям <i>name</i> та типом <i>tp</i>. Якщо атрибут вже присутній то будуть застосовані властивості, які можливо змінити "на ходу": ім'я, режим вибору та параметри вибору.
<ul><li> <i>id, name</i> — ідентифікатор та ім'я нового атрибуту;</li>
<li> <i>tp</i> — тип атрибута [boolean | integer | real | string | text | object] + режим вибору [sel | seled] + тільки для читання [ro];</li>
<li> <i>selValsNms</i> — два рядки зі значеннями у першому та їх іменами у другому, поділені ";".</li></ul></li>
<li> <i>bool attrDel( string id )</i> [<span style="color: red">для включеного параметру логічного типу</span>] — видалення атрибуту <i>id</i>.</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id=".D0.94.D0.BE.D0.B4.D0.B0.D1.82.D0.BE.D0.BA_A._.D0.9E.D0.B1.D0.BB.D0.B0.D1.81.D1.82.D1.96_.D0.94.D0.B0.D0.BD.D0.B8.D1.85_.D0.BF.D1.96.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D1.8C_ISO_TCP_.28.D0.B2.D0.B8.D1.85.D1.96.D0.B4.D0.BD.D0.B0_.D1.82.D0.B0.D0.B1.D0.BB.D0.B8.D1.86.D1.8F_LibnoDave.29"><span class="mw-headline-number">5</span> <span id="DataAreas" title="#DataAreas">Додаток A. Області Даних підключень ISO_TCP</span> (<a class="external text" href="http://www.proview.se/misc/libnodave/area.html" rel="nofollow noreferrer noopener" target="_blank">вихідна таблиця LibnoDave</a>)</span></h2>
<table class="wikitable">

<tr>
<th> Назва </th>
<th> Код </th>
<th> Елемент прикладу(Німецька) </th>
<th> Елемент прикладу(Англійська)
</th></tr>
<tr>
<td> Блоки даних </td>
<td> 132 </td>
<td> DB3.DBD4 </td>
<td> DB3.DBD4
</td></tr>
<tr>
<td> Прапорці/Маркери </td>
<td> 131 </td>
<td> MW4 </td>
<td> FW4
</td></tr>
<tr>
<td> Штамп вхідної пам'яті </td>
<td> 129 </td>
<td> EB2 </td>
<td> IB2
</td></tr>
<tr>
<td> Штамп вихідної пам'яті </td>
<td> 130 </td>
<td> AD8 </td>
<td> QD8
</td></tr>
<tr>
<td> Таймери </td>
<td> 29 </td>
<td> T2 </td>
<td> T2
</td></tr>
<tr>
<td> Лічильники </td>
<td> 28 </td>
<td> Z2 </td>
<td> C2
</td></tr>
<tr>
<td> Прямий В/В </td>
<td> 128 </td>
<td> PEW4 </td>
<td> PIW4
</td></tr>
<tr>
<td> Системна інформація сімейства 200 </td>
<td> 3 </td>
<td> </td>
<td>
</td></tr>
<tr>
<td> Дані (V-пам'ять) у S7-200 </td>
<td> 132 </td>
<td> VW1234 </td>
<td> VW1234
</td></tr>
<tr>
<td> Область системних прапорців сімейства 200 </td>
<td> 5 </td>
<td> SMB0 </td>
<td> SFB0?
</td></tr>
<tr>
<td> Слова аналогових входів сімейства 200 </td>
<td> 6 </td>
<td> AEW0 </td>
<td> AIW0?
</td></tr>
<tr>
<td> Слова аналогових виходів сімейства 200 </td>
<td> 7 </td>
<td> AAW0 </td>
<td> AQW0?
</td></tr>
<tr>
<td> IEC Таймери </td>
<td> 31 </td>
<td> T2 </td>
<td> T2
</td></tr>
<tr>
<td> IEC Лічильники </td>
<td> 30 </td>
<td> Z2 </td>
<td> C2
</td></tr></table>
<h2><span class="mw-headline" id=".D0.97.D0.B0.D1.83.D0.B2.D0.B0.D0.B6.D0.B5.D0.BD.D0.BD.D1.8F"><span class="mw-headline-number">6</span> <span id="Notes" title="#Notes">Зауваження</span></span></h2>
<p>Після цілеспрямованого пошуку було виявлено декілька рішень проблеми комунікації із промисловими контролерами фірми Siemens за посередництвом різних комунікаційних інтерфейсів:
</p>
<ul><li> Виявлено достатньо багато рішень від фірми Siemens, які постачаються із рішеннями, які підтримують відкриту ОС "Linux" (<a class="external free" href="http://www.automation.siemens.com/net/html_76/produkte/040_cp_1616.htm" rel="nofollow noreferrer noopener" target="_blank">http://www.automation.siemens.com/net/html_76/produkte/040_cp_1616.htm</a>, ...).</li></ul>
<p>Деякі специфічні проблеми та їх вирішення довкола комунікацій з ПЛК Siemens:
</p>
<table class="wikitable">

<tr>
<th> Проблема </th>
<th> Рішення
</th></tr>
<tr>
<td> Підключення скидається у ПЛК </td>
<td> Помилково визначений слот ЦП ПЛК, спробуйте якийсь інший.
</td></tr>
<tr>
<td> Підключення схоже встановлено, але дані з ПЛК не читаються. </td>
<td> Схоже на те, що Ви використовуєте S7-1200, який має різні зміни у політиці безпеки:
<ul><li> Створіть блок даних у сумісності з S7-300/400 та/або вимкніть оптимізацію цього блоку для появи стовпчика зміщення. Вимкніть будь-який захист цього блоку даних. </li>
<li> Якщо Ви маєте LibnoDave повідомлення "error 33028 context is not supported. Step7 says: Function not implemented or error in telegram.", то Ви маєте S7-1200 V4.0 та мусите <a class="external text" href="https://sourceforge.net/p/libnodave/discussion/205657/thread/7ec9f370/?limit=25" rel="nofollow noreferrer noopener" target="_blank">надати доступ для функцій інтерфейсу Get/Put</a> у конфігурації ПЛК.</li></ul>
</td></tr></table>
<h2><span class="mw-headline" id=".D0.9F.D0.BE.D1.81.D0.B8.D0.BB.D0.B0.D0.BD.D0.BD.D1.8F"><span class="mw-headline-number">7</span> Посилання</span></h2>
<ul><li> <a class="external" href="http://oscada.org/wiki/File:Siemens_cif2621.tgz" title="File:Siemens cif2621.tgz">Драйвер фірми Hilscher для плат сімейства CIF</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Siemens_lastkernels.patch" title="File:Siemens lastkernels.patch">Патч для збірки драйверу для ядра Linux 2.6.29</a></li>
<li> <a class="external" href="http://oscada.org/wiki/File:Siemens_crash_20160127_0911.crash.gz" title="File:Siemens crash 20160127 0911.crash.gz">Звіт про падіння, LibnoDave специфічне</a></li></ul>






</div><table style="border-top: dotted 2px #999999; margin-top: 20pt; color: gray;" width="100%"><tr><td style="text-align: left;" width="40%"><a href="http://oscada.org/wiki/Modules/Siemens/uk">Modules/Siemens/uk</a> - <a href="http://oscada.org/en/main/about-the-project/licenses/">GFDL</a></td><td style="text-align: center;">September 2021</td><td style="text-align: right;" width="40%">OpenSCADA 1+r2773</td></tr></table></body>
</html>