<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="UTF-8" />
<title>Modules/ModBus - OpenSCADAWiki</title>
<meta content="MediaWiki 1.26.4" name="generator" />
<link href="https://www.gnu.org/copyleft/fdl.html" rel="copyright" />
<link href="../files/doc.css" rel="stylesheet" /></head>
<body><div id="mw_header">
			<div class="mw-indicators">
</div>
			<h1 id="firstHeading" lang="en">Modules/ModBus</h1>
		</div><div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-pt-languages noprint" dir="ltr" lang="en"><div class="mw-pt-languages-label">Other languages:</div><div class="mw-pt-languages-list autonym"><span class="mw-pt-languages-ui mw-pt-languages-selected mw-pt-progress mw-pt-progress--complete">English</span>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/ModBus/ru" title="Модули/ModBus (100% translated)">российский</a>&nbsp;• ‎<a class="mw-pt-progress mw-pt-progress--complete" href="http://oscada.org/wiki/Modules/ModBus/uk" title="Модулі/ModBus (100% translated)">українська</a></div></div>
<table class="wikitable">

<tr>
<th> Module </th>
<th> Name </th>
<th> Version </th>
<th> License </th>
<th> Source </th>
<th> Languages </th>
<th> Platforms </th>
<th> Type </th>
<th> Author </th>
<th> Description
</th></tr>

<tr>
<td> <a href="../Modules/ModBus.html" title="Special:MyLanguage/Modules/ModBus">ModBus</a> </td>
<td> ModBus
</td>
<td> 2.6 </td>
<td> GPL2 </td>
<td> daq_ModBus.so </td>
<td> en,uk,ru,de </td>
<td> x86,x86_64,ARM
</td>
<td> DAQ </td>
<td> Roman Savochenko<br />Maxim Lysenko (2009) — the page translation </td>
<td> Provides implementation of the client ModBus service. ModBus/TCP, ModBus/RTU and ModBus/ASCII protocols are supported.
</td></tr>

<tr>
<td> <a href="../Modules/ModBus.html" title="Special:MyLanguage/Modules/ModBus">ModBus</a> </td>
<td> ModBus
</td>
<td> 2.1 </td>
<td> GPL2 </td>
<td> daq_ModBus.so </td>
<td> en,uk,ru,de </td>
<td> x86,x86_64,ARM
</td>
<td> Protocol </td>
<td> Roman Savochenko<br />Maxim Lysenko (2009) — the page translation </td>
<td> Provides implementation of ModBus protocols. ModBus/TCP, ModBus/RTU and ModBus/ASCII protocols are supported.
</td></tr></table>
<div class="toc" id="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#General_description_of_the_ModBus_protocol"><span class="tocnumber">1</span> <span class="toctext">General description of the ModBus protocol</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Addressing"><span class="tocnumber">1.1</span> <span class="toctext">Addressing</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Standard_codes_of_functions"><span class="tocnumber">1.2</span> <span class="toctext">Standard codes of functions</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Module_of_the_protocol_implementation"><span class="tocnumber">2</span> <span class="toctext">Module of the protocol implementation</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#API_of_the_function_of_the_output_requests"><span class="tocnumber">2.1</span> <span class="toctext">API of the function of the output requests</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Servicing_requests_of_the_ModBus_protocol"><span class="tocnumber">2.2</span> <span class="toctext">Servicing requests of the ModBus protocol</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#The_mode_.22Data.22"><span class="tocnumber">2.2.1</span> <span class="toctext">The mode "Data"</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#The_mode_.22Gateway_of_the_node.22"><span class="tocnumber">2.2.2</span> <span class="toctext">The mode "Gateway of the node"</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#The_mode_.22Gateway_of_the_network.22"><span class="tocnumber">2.2.3</span> <span class="toctext">The mode "Gateway of the network"</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Report_of_the_ModBus_requests"><span class="tocnumber">2.3</span> <span class="toctext"><span>Report of the ModBus requests</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Data_acquisition_module"><span class="tocnumber">3</span> <span class="toctext"><span>Data acquisition module</span></span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Controller_object"><span class="tocnumber">3.1</span> <span class="toctext">Controller object</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Parameters"><span class="tocnumber">3.2</span> <span class="toctext">Parameters</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#Standard_.28std.29"><span class="tocnumber">3.2.1</span> <span class="toctext">Standard (std)</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Logical_.28logic.29"><span class="tocnumber">3.2.2</span> <span class="toctext">Logical (logic)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-16"><a href="#User_programming_API"><span class="tocnumber">3.3</span> <span class="toctext"><span>User programming API</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Links"><span class="tocnumber">4</span> <span class="toctext">Links</span></a></li>
</ul>
</div>

<p>ModBus — communication protocol based on the client-server architecture. It was developed by Modicon for using in the programmable logic controllers (PLC). It became the de facto standard in the industry and is widely used for the connection of industrial electronic equipment. Used to transfer data via serial line RS-485, RS-422, RS-232, and network TCP/IP. Currently supported non-profit organization ModBus-IDA.
</p><p>There are three modes of the protocol: ModBus/RTU, ModBus/ASCII and ModBus/TCP. The first two use the serial communication lines (mostly RS-485, less RS-422/RS-232), the last uses TCP/IP network to transfer data.
</p><p>The module of the data acquisition provides an opportunity to gather the information from various devices by means of the protocol ModBus in all modes. Also, the module implements the functions of the horizontal redundancy, that is working in conjunction with the remote station of the same level. At the same time, the module of the protocol allows you to create and issue data by means of the protocol ModBus in various modes, and through interfaces that are supported by modules of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#Communication" title="Special:MyLanguage/Documents/Program manual">the subsystem "Transports"</a>.
</p>
<h2><span class="mw-headline" id="General_description_of_the_ModBus_protocol"><span class="mw-headline-number">1</span> General description of the ModBus protocol</span></h2>
<p>Protocol ModBus/{RTU,ASCII} means one lead (requesting) device in the line (master), which can send commands to one or more driven devices (slave), referring to them by a unique address in the line. Syntax of the commands of the protocol allows to address 247 devices on the one connection line of standard RS-485 (less RS-422 or RS-232). In the case of TCP, the addressing excluded from the protocol, as it is implemented in the TCP/IP stack.
</p><p>Initiative of the exchanging always comes from the leading device. The slave devices listen the line. The master requests (package, the sequence of bytes) in the line and switches into  listening the line. The slave device responds to the request, which came to his address. 
</p><p>The end of sending the response is determined by the mode. In the RTU mode, the massage end is determined by the time interval between end of receiving the previous byte and start of receiving the following one — the symbol time. If this interval exceeds the time required to receiving one and a half bytes on a given rate of transmission then receiving the response frame is considered complete. In the ASCII mode, the criterion of the massage end is the character '\r', and in the TCP mode — the expected size of the massage, information about which present in the packet header.
</p>
<h3><span class="mw-headline" id="Addressing"><span class="mw-headline-number">1.1</span> Addressing</span></h3>
<p>All data operations are tied to zero, each type of the data (register, bit, register of input or bit of input) addresses begin with <b>0</b> and ends <b>65535</b>.
</p>
<h3><span class="mw-headline" id="Standard_codes_of_functions"><span class="mw-headline-number">1.2</span> Standard codes of functions</span></h3>
<p>In the ModBus protocol can be exude multiple sets of commands (Table 1).
</p><p><b>Table 1:</b> The subsets of commands of the ModBus protocol
</p>
<table class="wikitable">

<tr>
<th> Subset </th>
<th> Range of codes
</th></tr>
<tr>
<td> Standard </td>
<td> 1-21
</td></tr>
<tr>
<td> Reserve for advanced features </td>
<td> 22-64
</td></tr>
<tr>
<td> Custom </td>
<td> 65-119
</td></tr>
<tr>
<td> Reserve for own needs </td>
<td> 120-255
</td></tr></table>
<p>The data acquisition module uses commands <b>3</b> and <b>6(16)</b> for read and write registers, <b>1</b> and <b>5(16)</b> for read and write bits, <b>2</b> and <b>4</b> for read bit and register of input, accordingly. For implementation other and atypical commands the module provides <a href="#UserAPI">a function of the user programming API</a>, which you can call from <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/DAQ#LogicLev" title="Special:MyLanguage/Documents/DAQ">the template procedure of the logical level</a>, sending arbitrary PDU packages and processing received ones in reply.
</p><p>The protocol module processes the requests by the commands <b>3</b> and <b>6(16)</b> for reading and writing registers, <b>1</b> and <b>5(15)</b> for reading and writing bits.
</p>
<h2><span class="mw-headline" id="Module_of_the_protocol_implementation"><span class="mw-headline-number">2</span> Module of the protocol implementation</span></h2>
<p>The ModBus protocol module contains the code implementing of the protocol part of ModBus, that is specifics of variants of the protocols ModBus/TCP, ModBus/RTU and ModBus/ASCII. The protocol module in conjunction with the selected transport is actively used by the data acquisition module for implementation the direct queries. Due for the protocol module is independent, using it you can create additional modules for data acquisition by non-standard functions of the ModBus expansion of various automation equipment.
</p>
<h3><span class="mw-headline" id="API_of_the_function_of_the_output_requests"><span class="mw-headline-number">2.1</span> API of the function of the output requests</span></h3>
<p>API of the function for the output requests (<a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/User_API#SYSTransport" title="Special:MyLanguage/Documents/User API">messIO()</a>) operates of exchanging the PDU-blocks, wrapped into the XML-packages, with the following structure:
</p>
<ul><li> <b>&lt;{prt} id="{sId}" reqTm="{reqTm}" node="{node}" reqTry="{reqTry}"&gt;{pdu}&lt;/{prt}&gt;</b></li></ul>
<dl><dd>Where:
<ul><li> <i>prt</i> — name of the tag with the name of the used variant of the protocol (TCP, RTU or ASCII).</li>
<li> <i>sId</i> — identifier of the source of the query. Used for placing to <a href="#Report">the output protocol report</a>.</li>
<li> <i>reqTm</i> — time of the request, that is the time during which the answer is expected, in milliseconds.</li>
<li> <i>node</i> — number of the destination node or identifier of the ModBus/TCP unit.</li>
<li> <i>reqTry</i> — number of attempts of repeating the request with the error in the answer. Only for ModBus/RTU and ModBus/ASCII.</li>
<li> <i>pdu</i> — directly block of the data unit (PDU) of the ModBus protocol.</li></ul></dd></dl>
<p>The resulting <i>pdu</i> replaces the requested <i>pdu</i> in the XML-package, and sets the attribute "err" to the code and text of the error, if it is took place.
</p>
<h3><span class="mw-headline" id="Servicing_requests_of_the_ModBus_protocol"><span class="mw-headline-number">2.2</span> Servicing requests of the ModBus protocol</span></h3>
<p>Input part of servicing of the requests to the protocol module realizes verification and processing of the requests through object nodes provided by the module (Fig.1). Actually, a mechanism is implemented, that allows OpenSCADA to perform the role of the ModBus/TCP server or the slave device of ModBus/{RTU,ASCII}. Thus OpenSCADA gets an opportunity to serve the role of any participant of the ModBus network.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:637px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_nodes.png"><img class="thumbimage" height="488" src="../files/ModBus_prt_nodes.png" width="635" /></a>  <div class="thumbcaption">Fig.1. Tab of the list of the nodes servicing input requests of the protocol.</div></div></div></div>
<p>The protocol node is equivalent to the physical node of the device of the ModBus network and can operate in three modes:
</p>
<ul><li> "Data" — mode of reflection of the OpenSCADA data on arrays of registers and bits of ModBus to transfer them at the request of the client node or master.</li>
<li> "Gateway of the node" — mode of redirecting of the requests to the node of the another ModBus network through this node.</li>
<li> "Gateway of the network" — mode of redirecting of the requests to any node in another ModBus network, actually carrying out the integration of several ModBus networks into one.</li></ul>
<p>Since the protocol nodes can be created a great number, it turns out that on the one interface, i.e. in the one network, one station on the basis of OpenSCADA can clear provide multiple nodes of the ModBus network with different data.
</p><p>Consider the specific of the configuration of the protocol node in different modes.
</p>
<h4><span class="mw-headline" id="The_mode_.22Data.22"><span class="mw-headline-number">2.2.1</span> The mode "Data"</span></h4>
<p>The mode is used to reflect the OpenSCADA data on arrays of registers and bits of ModBus. The overall configuration of the node is made in the tab "Node" (Fig.2) by the parameters:
</p>
<ul><li> State of the node, as follows: Status, "Enabled" and the name of the database containing the configuration.</li>
<li> Identifier, name and description of the node.</li>
<li> The state "Enabled", in which the node must be translated at boot.</li>
<li> Address of the node in the ModBus network from 1 to 247.</li>
<li> Input transport, to the network of which the node is belonged to. It is selected from the list of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportIn" title="Special:MyLanguage/Documents/Program manual">input transports</a> of the subsystem "Transports" of OpenSCADA. Specifying the symbol "*" as the transport makes this node a participant of any ModBus network with the processing of requests from any transport.</li>
<li> Variant of the ModBus protocol, requests in which must be processed by the node from the list: All, RTU, ASCII, TCP/IP.</li>
<li> Choice of the mode, in this case the mode "Data".</li>
<li> Period of calculation of the data in seconds. Specifies the processing period of the data, which forming for the requests, that is: data tables of ModBus, the program of data calculation and servicing of links to the data of OpenSCADA.</li>
<li> <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#DAQTmpl" title="Special:MyLanguage/Documents/Program manual">DAQ template</a> or direct procedure language. Provides the selection of a template or language for a direct procedure for the formation and computation of ModBus data tables, as well as for servicing external links to the data model of the subsystem "Data Acquisition".</li></ul>
<p>Node in this mode processes the following standars commands of the ModBus protocol:
</p>
<ul><li> <b>1</b> — reading the group of bits;</li>
<li> <b>2</b> — reading the group of input bits;</li>
<li> <b>3</b> — reading the group of registers;</li>
<li> <b>4</b> — reading the group of input registers;</li>
<li> <b>5</b> — setting the single bit;</li>
<li> <b>6</b> — setting the single register;</li>
<li> <b>15</b> — setting the group of bits;</li>
<li> <b>16</b> — setting the group of registers.</li></ul>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:899px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_node_node.png"><img class="thumbimage" height="643" src="../files/ModBus_prt_node_node.png" width="897" /></a>  <div class="thumbcaption">Fig.2. Tab "Node" of the configuration page of a node of the protocol in the "Data" mode.</div></div></div></div>
<p>To form the table of reflection the ModBus network data, that is registers and bits, the tab "Data" is provided (Fig.3). The tab "Data" contains a table of parameters and program of processing the parameters with the specified programming language which is available in OpenSCADA, but in the template there is only the table available and in the "Enabled" mode. The table contains parameters with the properties:
</p>
<ul><li> <i>Identifier</i> — identifier of the parameter. It is the key for formation of the tables of registers and bits of ModBus. Registers and bits of ModBus set as follows:</li></ul>
<dl><dd><ul><li> <b>R{N}[w]</b>, <b>RI{N}[w]</b> — specific register and input register form, can be expanded by the suffixes: "i"—Int32, "f"—Float, "d"—Double, "s"—String (by default the size is 10 and up to 100 registers);</li>
<li> <b>R:{N}[:w]</b>, <b>RI:{N}[:w]</b> — classic register and input register form, can be expanded by the suffixes: "i4"—Int32, "i8"—Int64, "f"—Float, "d"—Double, "s"—String</li>
<li> <b>C{N}[w]</b>, <b>CI{N}[w]</b>, <b>C:{N}[:w]</b>, <b>CI:{N}[:w]</b> — coil and input coil.</li></ul></dd>
<dd>Where:
<ul><li> <b>{N}</b> — ModBus device's data address (decimal, hexadecimal or octal) [0...65535];</li>
<li> <b>w</b> — optional character to indicate writing capability.</li></ul></dd>
<dd>Examples:
<dl><dd>"R0x300w" — register access;</dd>
<dd>"C100w" — coin access, allowed to write;</dd>
<dd>"R_f200" — get float from registers 200 and 201;</dd>
<dd>"R_i400,300" — get int32 from registers 400 and 300;</dd>
<dd>"R_s15,20" — get string, registers block, from register 15 and size 20.</dd>
<dd>"R_i8:0x10:w" — get and set int64 into registers [0x10-0x13];</dd>
<dd>"R_d:0x20,0x30" — get double float point (8 byte) from registers [0x20,0x30-0x32].</dd></dl></dd></dl>
<dl><dt> All other parameters are internal and used for a variety of intermediate calculations, processing, conversion and their values can be operative controlled and changed from the table into execution mode.</dt></dl>
<ul><li> <i>Name</i> — name of the parameter, is used for the naming of the connection.</li>
<li> <i>Type</i> — type of the parameter from the list: "Real", "Integer", "Boolean" and "String". For the registers and bits of ModBus it makes sense to set the "Integer" and "Boolean" type, respectively. For registers, extended by "f" and "s" prefixes, you must specify the "Real" and "String" types respectively.</li>
<li> <i>Link</i> — a sign that this parameter should be connected with the parameter attribute of the subsystem "Data acquisition". The links indicated by this sign are set in the "Template configuration" tab.</li>
<li> <i>Value</i> — original or current value of the parameter, if the node is switched on.</li></ul>
<p>The table by default specifies several parameters of special appointment:
</p>
<ul><li> <i>f_frq</i> — frequency of computing the table by the program;</li>
<li> <i>f_start</i> — sign of the first computing — the program start up.</li>
<li> <i>f_stop</i> — sign of the last execution — the program stop down.</li></ul>
<p><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> Since an invalid character ',' can be used in the index of extended types of registers, access to it from the program can only be done in an alternative way through the "argument" object:
</p>
<pre style="white-space: pre-wrap;">
arguments["R_s10,5w"] = "9876543210";</pre>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:793px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_node_data.png"><img class="thumbimage" height="655" src="../files/ModBus_prt_node_data.png" width="791" /></a>  <div class="thumbcaption">Fig.3. Tab "Data" of the configuration page of a protocol node in the "Data" mode.</div></div></div></div>
<p>For the parameters specified as links, the links can be set for the enabled protocol node and in the "Template configuration" tab (Fig. 4).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:679px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_node_lnk.png"><img class="thumbimage" height="581" src="../files/ModBus_prt_node_lnk.png" width="677" /></a>  <div class="thumbcaption">Fig.4. Tab "Template configuration" of the configuration page of a protocol node in the "Data" mode.</div></div></div></div>
<h4><span class="mw-headline" id="The_mode_.22Gateway_of_the_node.22"><span class="mw-headline-number">2.2.2</span> The mode "Gateway of the node"</span></h4>
<p>The mode is used to carryover the requests to a separate device in the other ModBus network, from the ModBus network in which this node is configured. The overall configuration of the node is made in the tab "Node"(Fig. 5) by the parameters:
</p>
<ul><li> State of the node, as follows: Status, "Enabled" and the name of the database containing the configuration.</li>
<li> Identifier, name and description of the node.</li>
<li> The state "Enabled", in which the node must be translated at boot.</li>
<li> Address of the node in the ModBus source network, from 1 to 247.</li>
<li> Input transport, of the network the node is belonged to. It is selected from the list of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportIn" title="Special:MyLanguage/Documents/Program manual">input transports</a> of the subsystem "Transports" of OpenSCADA. Specifying the symbol "*" as the transport makes this node a participant of any ModBus network with the processing of requests from any transport.</li>
<li> Variant of the ModBus protocol, requests in which must be processed by the node, from the list: All, RTU, ASCII, TCP/IP.</li>
<li> The mode choice, in this case the mode "Gateway of the node".</li>
<li> Transport, in which the request must be redirected, from the list of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportOut" title="Special:MyLanguage/Documents/Program manual">output transports</a> of the subsystem "Transports".</li>
<li> Protocol, in which to redirect the request.</li>
<li> Address of the ModBus network node from 1 to 247, in which the request is forwarded to.</li></ul>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:668px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_node_nodeGwNode.png"><img class="thumbimage" height="678" src="../files/ModBus_prt_node_nodeGwNode.png" width="666" /></a>  <div class="thumbcaption">Fig.5. Tab "Node" of the configuration page of a protocol node in the "Gateway of the node" mode.</div></div></div></div>
<h4><span class="mw-headline" id="The_mode_.22Gateway_of_the_network.22"><span class="mw-headline-number">2.2.3</span> The mode "Gateway of the network"</span></h4>
<p>The mode is used to carryover the requests of the network at whole to the other ModBus network, from the ModBus network in which this node is configured. I.e. request to the device with any address will be sent to another network, without the readdressing. Overall configuration of the node is made in the tab "Node" (Fig. 6) by the parameters:
</p>
<ul><li> State of the node, as follows: Status, "Enabled" and the name of the database containing the configuration.</li>
<li> Identifier, name and description of the node.</li>
<li> The state "Enabled", in which the node must be translated at boot.</li>
<li> Input transport of the network, from which the requests are transferred. It is selected from the list of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportIn" title="Special:MyLanguage/Documents/Program manual">input transports</a> of the subsystem "Transports" of OpenSCADA.</li>
<li> Variant of the ModBus protocol, requests in which must be processed by the node, from the list: All, RTU, ASCII, TCP/IP.</li>
<li> The mode choice, in this case the mode "Gateway of the network".</li>
<li> Transport, in which the request must be redirected, from the list of <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportOut" title="Special:MyLanguage/Documents/Program manual">output transports</a> of the subsystem "Transports".</li>
<li> Protocol, in which to redirect the request.</li></ul>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:668px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prt_node_nodeGwNet.png"><img class="thumbimage" height="632" src="../files/ModBus_prt_node_nodeGwNet.png" width="666" /></a>  <div class="thumbcaption">Fig.6. Tab "Node" of the configuration page of a protocol node in the "Gateway of the network" mode.</div></div></div></div>
<h3><span class="mw-headline" id="Report_of_the_ModBus_requests"><span class="mw-headline-number">2.3</span> <span id="Report" title="#Report">Report of the ModBus requests</span></span></h3>
<p>To monitor and diagnose the correctness of requests for various components, the module provides the ability to enable a report of requests that pass through the protocol module. The report is included by specifying a non-zero number of entries in the "Report" tab of the protocol module page (Fig. 7).
</p><p><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> This mechanism is mostly obsolete as its functions are currently performed by the program core:
</p>
<ul><li> <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#DAQDiagnostic" title="Special:MyLanguage/Documents/Program manual">diagnostic of the data sources</a>;</li>
<li> <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TrDiagnostic" title="Special:MyLanguage/Documents/Program manual">traffic log through the transport</a>.</li></ul>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:704px;"><a class="image" href="http://oscada.org/wiki/File:Modbus_prt_rep.png"><img class="thumbimage" height="632" src="../files/Modbus_prt_rep.png" width="702" /></a>  <div class="thumbcaption">Fig.7. Tab "Report" of the protocol module page.</div></div></div></div>
<h2><span class="mw-headline" id="Data_acquisition_module"><span class="mw-headline-number">3</span> <span id="DAQ" title="#DAQ">Data acquisition module</span></span></h2>
<p>The data acquisition module provides an opportunity to acquisition and writing registers and bits of devices through protocol modes TCP, RTU, ASCII and commands of request <b>1</b> — <b>6</b>, <b>15</b>, <b>16</b>.
</p>
<h3><span class="mw-headline" id="Controller_object"><span class="mw-headline-number">3.1</span> Controller object</span></h3>
<p>To add a data source of ModBus the controller object of OpenSCADA creates and configures. An example of a configuration tab for a controller object of this type is shown in Figure 8.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:810px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_cntr.png"><img class="thumbimage" height="837" src="../files/ModBus_cntr.png" width="808" /></a>  <div class="thumbcaption">Fig.8. Configuration tab of a controller object.</div></div></div></div>
<p>Using this tab you can set:
</p>
<ul><li> The state of the controller object, as follows: Status, "Enabled", "Running" and the name of the database containing the configuration.</li>
<li> Identifier, name and description of the controller.</li>
<li> The state "Enabled" and "Running", in which the controller object must be translated at boot.</li>
<li> Names of tables of storing the configuration of the parameters of the controller object for standard and logical types.</li>
<li> Policy of scheduling and priority of the data acquisition task.</li>
<li> ModBus protocol, used for requesting the real device (TCP/IP, RTU or ASCII).</li>
<li> Address of the output transport from a list of configured <a class="external" href="http://oscada.org/wiki/Special:MyLanguage/Documents/Program_manual#TransportOut" title="Special:MyLanguage/Documents/Program manual">output transports</a> in the "Transports" subsystem of OpenSCADA. Default port of the ModuBus/TCP is 502. The field may be set to empty and be changed at the runtime.</li>
<li> ModBus destination node. In the case of protocols RTU and ASCII this is the unique address of the physical device, and when TCP/IP this is the identifier of the unity.</li>
<li> Merging of the data fragments. Standard functions <b>1</b>-<b>4</b> let to request at once multiple adjacent registers or bits. This strategy often allows to optimize the traffic and time. However, the required registers are not always located adjacent to each other, this option allows you to gather them in blocks of up to 100 registers, or 1600 bits.</li></ul>
<dl><dd><a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> Installing of this parameter must be approached with caution, since not all devices support access to the registers between fragments.</dd></dl>
<ul><li> Using the multi-items writing functions (<b>15</b>, <b>16</b>). Instead one-item writing will be used the multi-items functions.</li>
<li> Asynchronous write. Enables asynchronously writing of the changes to the controller, in the general acquisition cycle and after the data acquisition itself, blocking of reading the written values on one cycle (before the writing buffer clearing).</li></ul>
<dl><dd> <a class="image" href="http://oscada.org/wiki/File:At.png"><img alt="At.png" height="22" src="../files/At.png" width="22" /></a> This mode also prevents for lost the writing data at the connection lost and the wrote data will be transmitted just the connection will be restored. At that, this blocks the reading of the just written data to allow the PLC time to accept changes.</dd></dl>
<ul><li> Timeout of connection in milliseconds. Specifies the time interval during which the answer is expected. If there is zero waiting time the transport waiting time by default is used. Allows taking into account individual properties of the controller in the common network.</li>
<li> Timeout of restore in seconds. Specifies the time interval after which the re-attempt of the request to previously inaccessible device is done.</li>
<li> Request tries for the protocols RTU and ASCII. Indicates the number of attempts by the repetition of the request in case of incomplete or damaged answer.</li>
<li> Maximum size of the request block in bytes. Useful for controllers with like limits.</li></ul>
<h3><span class="mw-headline" id="Parameters"><span class="mw-headline-number">3.2</span> Parameters</span></h3>
<p>Data acquisition module provides two types of parameter: "Standard (std)" and "Logical (logic)". Additional configuration fields of the parameters of this module are:
</p>
<ul><li> <i><b>Standard (std)</b></i>:
<ul><li> <i>Attributes list</i> — contains a structured list of configuration for the attributes ModBus.</li></ul></li>
<li> <i><b>Logical (logic)</b></i>:
<ul><li> <i>Parameter template</i> — address of a DAQ parameter template.</li></ul></li></ul>
<h4><span class="mw-headline" id="Standard_.28std.29"><span class="mw-headline-number">3.2.1</span> Standard (std)</span></h4>
<p>Main page of configuration parameters of the standard type is shown in Figure 9.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:670px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prm.png"><img class="thumbimage" height="656" src="../files/ModBus_prm.png" width="668" /></a>  <div class="thumbcaption">Fig.9. Configuration tab of the standard parameter type.</div></div></div></div>
<p>Attribute in the attributes list parameter can be written as follows: <b>{dt}:{numb}[:{flg}[:{id}[:{name}]]]</b>.<br />
Where:
</p>
<ul><li> <i>dt</i> — Modbus data type ("R"—register[3,6(16)], "C"—coil[1,5(15)], "RI" — input register[4], "CI"—input coil[2]);</li></ul>
<dl><dd>"R" and "RI" can be expanded by the suffixes: "i2"—Int16, "i4"—Int32, "i8"—Int64, "u2"—UInt16, "u4"—UInt32, "f"—Float, "d"—Double, "b5"—Bit5, "s"—String (size by default is 10 and up to 100 registers);</dd></dl>
<ul><li> <i>numb</i> — ModBus data address of the device (decimal, hexadecimal or octal) [0...65535];</li>
<li> <i>flg</i> — flags: read/write mode (r-read; w-write; rw-read and write), strict requesting mode (not combining) 's';</li>
<li> <i>id</i> — identifier of the created attribute;</li>
<li> <i>name</i> — name of the created attribute.</li></ul>
<p>Examples:
</p>
<dl><dd>"R:0x300:rw:var:Variable" — register access;</dd>
<dd>"C:100:rw:var1:Variable 1" — coin access;</dd>
<dd>"R_f:200:r:float:Float" — get float from registers 200 and 201;</dd>
<dd>"R_i4:400,300:r:int32:Int32" — get int32 from registers 400 and 300;</dd>
<dd>"R_b10:25:r:rBit:Reg bit" — get bit 10 from register 25;</dd>
<dd>"R_s:15,20:r:str:Reg blk" — get string (registers block) from register 15 and size 20."</dd></dl>
<p>String starting with the '#' character is considered a comment and is not processed.
</p><p>In accordance with the specified attributes list, an acquisition and creation of attributes of the parameter are performed (Fig. 10).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:640px;"><a class="image" href="http://oscada.org/wiki/File:ModBus_prm_atr.png"><img class="thumbimage" height="533" src="../files/ModBus_prm_atr.png" width="638" /></a>  <div class="thumbcaption">Fig.10. Tab of attributes of the standard parameter type.</div></div></div></div>
<h4><span class="mw-headline" id="Logical_.28logic.29"><span class="mw-headline-number">3.2.2</span> Logical (logic)</span></h4>
<p>Main page of configuration parameters of the logical type is shown in Figure 11.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:713px;"><a class="image" href="http://oscada.org/wiki/File:ModBusLog_prm.png"><img class="thumbimage" height="526" src="../files/ModBusLog_prm.png" width="711" /></a>  <div class="thumbcaption">Рис.11. Configuration tab of the logical parameter type.</div></div></div></div>
<p>Link value, when configuring the template (Fig.12), is written in the format: <b>{dt}:{numb}[:{rw}]</b>.<br />
Where:
</p>
<ul><li> <i>dt</i> — ModBus data type ("R"—register[3,6(16)], "C"—coil[1,5(15)], "RI"—input register[4], "CI"—input coil[2]);</li></ul>
<dl><dd>"R" and "RI" can be expanded by the suffixes: "i2"—Int16, "i4"—Int32, "i8"—Int64, "u2"—UInt16, "u4"—UInt32, "f"—Float, "d"—Double, "b5"—Bit5, "s"—String (size by default is 10 and up to 100 registers);</dd></dl>
<ul><li> <i>numb</i> — ModBus data address of the device (decimal, hexadecimal or octal) [0...65535];</li>
<li> <i>rw</i> — read/write mode ("r"—read; "w"—write; "rw"—readwrite).</li></ul>
<p>Examples:
</p>
<dl><dd>"R:0x300:rw" — register access;</dd>
<dd>"C:100:rw" — coin access;</dd>
<dd>"R_f:200:r" — get float from registers 200 and 201;</dd>
<dd>"R_i4:400,300:r" — get int32 from registers 400 and 300;</dd>
<dd>"R_b10:25:r" — get bit 10 from register 25;</dd>
<dd>"R_s:15,20:r" — get string (registers block) from register 15 and size 20.</dd></dl>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:713px;"><a class="image" href="http://oscada.org/wiki/File:ModbusLog_tmpl.png"><img class="thumbimage" height="526" src="../files/ModbusLog_tmpl.png" width="711" /></a>  <div class="thumbcaption">Рис.12. Tab "Template configuration" of the logical parameter type.</div></div></div></div>
<p>The module provides a special processing of a number of attributes of the template:
</p>
<ul><li> <i>f_frq</i> — frequency of the calculation of the template procedure or the time after the last calculation (negative in seconds) for planning by CRON, read-only.</li>
<li> <i>f_start</i> — sign of the first execution of the template procedure — start-up, read-only.</li>
<li> <i>f_stop</i> — sign of the last execution of the template procedure — stop, read only.</li>
<li> <i>f_err</i> — parameter error, full access. The value of this attribute of the template falls into the error attribute of the parameter "err". Write here <b>EVAL</b> for the possibility of setting the attribute "err" from the outside and all others in the Read Only mode.</li>
<li> <i>SHIFR</i> — code of the parameter, read-only.</li>
<li> <i>NAME</i> — name of the parameter, read-only.</li>
<li> <i>DESCR</i> — description of the parameter, read-only.</li>
<li> <i>this</i> — object of the parameter, allows access to the attributes of the parameter, for example, to access archives-history.</li></ul>
<p>In accordance with the template, underlying the parameter, we obtain a set of attributes of the parameter (Fig. 13).
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:713px;"><a class="image" href="http://oscada.org/wiki/File:ModbusLog_prm_atr.png"><img class="thumbimage" height="526" src="../files/ModbusLog_prm_atr.png" width="711" /></a>  <div class="thumbcaption">Fig.13. Tab of attributes of the logical parameter type.</div></div></div></div>
<h3><span class="mw-headline" id="User_programming_API"><span class="mw-headline-number">3.3</span> <span id="UserAPI" title="#UserAPI">User programming API</span></span></h3>
<p>Due to the support of the logical type parameters, it makes sense to provide a number of functions of the user API for calling them from the template of the logical parameter.
</p>
<div class="floatright"><a class="image" href="http://oscada.org/wiki/File:Oscada_UserOM_ModBus.png" title="User object model of the module ModBus."><img alt="User object model of the module ModBus." height="215" src="../files/Oscada_UserOM_ModBus.png" width="323" /></a></div>
<p><b>The object "Controller" [this.cntr()]</b>
</p>
<ul><li> <i>string messIO(string pdu)</i> — sends <i>pdu</i> through the transport of the controller object by means of the ModBus protocol. PDU query result is placed instead of the query <i>pdu</i>, and the error returned by the function.</li></ul>
<p><b>The object "Parameter" [this]</b>
</p>
<ul><li> <i>bool attrAdd( string id, string name, string tp = "real", string selValsNms = "" )</i> [<span style="color: red">for enabled parameter of the logical type</span>] — adds the attribute <i>id</i> with the name <i>name</i> and the type <i>tp</i>. If the attribute is already present, the properties will be applied that can be changed on the go: name, selection mode and selection options.
<ul><li> <i>id, name</i> — identifier and name of the new attribute;</li>
<li> <i>tp</i> — attribute type [boolean | integer | real | string | text | object] + selection mode [sel | seled] + read-only [ro];</li>
<li> <i>selValsNms</i> — two lines with values in first and their names in second, separated by ";".</li></ul></li>
<li> <i>bool attrDel( string id )</i> [<span style="color: red">for enabled parameter of the logical type</span>] — removes the attribute <i>id</i>.</li></ul>
<p><br />
</p>
<h2><span class="mw-headline" id="Links"><span class="mw-headline-number">4</span> Links</span></h2>
<ul><li> <a class="external" href="http://oscada.org/wiki/File:Oscada_UserOM_ModBus.odg" title="File:Oscada UserOM ModBus.odg">Diagram: User object model of the module ModBus.</a></li></ul>






</div></body>
</html>